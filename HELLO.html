<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ropar Institute Portal | The Campus Super App</title>
    <!-- Importing Inter Font for Premium Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Brand Colors */
            --primary: #6366f1; /* Indigo */
            --primary-glow: rgba(99, 102, 241, 0.4);
            --secondary: #ec4899; /* Pink */
            --accent: #10b981; /* Emerald */
            --danger: #ef4444; /* Red for alerts */
            
            /* Dark Mode (Default) */
            --bg-body: #0f172a;
            --bg-surface: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.7);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.08);
            
            /* Spacing & Radius */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            --nav-height: 70px;
            
            /* Shadows & Effects */
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.5);
            --glass-blur: blur(20px);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* Light Mode Override */
        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-surface: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.8);
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border-color: rgba(0, 0, 0, 0.06);
            --shadow-soft: 0 10px 30px -10px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
        }

        /* --- Layout & Utilities --- */
        .app-container {
            max-width: 600px; 
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            padding-bottom: calc(var(--nav-height) + 20px);
            background: var(--bg-body);
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
        }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        /* --- Header --- */
        header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: var(--bg-glass);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .brand {
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--text-main);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        .icon-btn:active { transform: scale(0.9); }
        
        .badge {
            position: absolute;
            top: -2px; right: -2px;
            background: var(--secondary);
            width: 8px; height: 8px;
            border-radius: 50%;
        }

        /* --- Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 560px;
            height: var(--nav-height);
            background: var(--bg-glass);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 35px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-shadow: var(--shadow-soft);
            padding: 0 10px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            width: 50px;
        }

        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-3px); text-shadow: 0 4px 12px var(--primary-glow); }

        /* --- Sections --- */
        section { padding: 20px; }
        .section-header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: end; }
        .section-title { font-size: 1.5rem; font-weight: 700; margin: 0; }

        /* --- Cards & Grid --- */
        .card {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        .card:active { transform: scale(0.98); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* --- Buttons & Inputs --- */
        .btn {
            background: var(--bg-surface);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary {
            background: var(--primary); color: white; border: none;
            box-shadow: 0 4px 15px var(--primary-glow);
        }
        .search-container { position: relative; margin-bottom: 20px; }
        .search-input {
            width: 100%;
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            padding: 14px 14px 14px 45px;
            border-radius: var(--radius-md);
            color: var(--text-main); font-family: inherit; outline: none;
        }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        /* --- Modals & Toasts --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 200; display: flex; align-items: flex-end;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-content {
            background: var(--bg-surface);
            width: 100%; max-width: 600px; margin: 0 auto;
            border-radius: 30px 30px 0 0; padding: 30px;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            max-height: 85vh; overflow-y: auto; position: relative;
        }
        .modal-overlay.open .modal-content { transform: translateY(0); }
        .modal-close { position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; }

        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--bg-surface); color: var(--text-main);
            padding: 12px 24px; border-radius: 50px; box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-color); z-index: 300;
            display: flex; align-items: center; gap: 10px; font-weight: 500;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 90%; max-width: 400px;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* --- NEW FEATURES STYLES --- */
        
        /* Utilities Grid */
        .utility-card-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .utility-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 15px;
            text-align: center;
        }
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;
        }
        .dot-green { background-color: var(--accent); box-shadow: 0 0 5px var(--accent); }
        .dot-red { background-color: var(--danger); box-shadow: 0 0 5px var(--danger); }
        .dot-yellow { background-color: #f59e0b; box-shadow: 0 0 5px #f59e0b; }

        /* Mess Menu */
        .mess-tabs { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .mess-tab {
            padding: 8px 16px; border-radius: 20px; background: var(--bg-surface);
            border: 1px solid var(--border-color); white-space: nowrap; cursor: pointer; font-size: 0.9rem;
        }
        .mess-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
        .meal-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid var(--border-color);
        }
        .meal-item:last-child { border-bottom: none; }
        .rating-stars { color: #f59e0b; font-size: 0.8rem; }
        .crowd-indicator { font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .crowd-low { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .crowd-high { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* Mail Summarizer */
        .mail-filters { display: flex; gap: 10px; margin-bottom: 15px; }
        .mail-chip {
            padding: 6px 12px; border-radius: 15px; background: rgba(255,255,255,0.05);
            font-size: 0.8rem; cursor: pointer; border: 1px solid transparent;
        }
        .mail-chip.active { border-color: var(--primary); color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .priority-badge {
            padding: 3px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase;
        }
        .prio-urgent { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .prio-normal { background: rgba(16, 185, 129, 0.2); color: var(--accent); }
        .summary-text { color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; font-style: italic; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }

        /* --- NEW MODULE STYLES --- */

        /* Hub Grid */
        .hub-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 10px; }
        .hub-card {
            background: var(--bg-surface); border: 1px solid var(--border-color);
            border-radius: var(--radius-md); padding: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; cursor: pointer; transition: var(--transition);
            aspect-ratio: 1;
        }
        .hub-card:active { transform: scale(0.95); background: rgba(99, 102, 241, 0.1); }
        .hub-icon { font-size: 2rem; margin-bottom: 15px; color: var(--primary); }
        .hub-title { font-weight: 600; font-size: 0.95rem; }

        /* Marketplace */
        .market-list { display: flex; flex-direction: column; gap: 10px; }
        .market-item {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .market-item:active { transform: scale(0.98); background: rgba(99, 102, 241, 0.05); }
        .market-item::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .market-item:hover::before { opacity: 1; }
        
        .market-icon {
            width: 50px; height: 50px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: var(--primary);
            flex-shrink: 0;
        }
        .market-info { flex: 1; }
        .market-title { font-weight: 600; font-size: 1rem; margin-bottom: 4px; color: var(--text-main); }
        .market-meta { font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 10px; }
        .market-price { font-weight: 700; color: var(--accent); font-size: 1.1rem; }
        .market-condition { 
            font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; 
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-color);
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Lost & Found */
        .lf-tabs { display: flex; background: var(--bg-surface); border-radius: 12px; padding: 4px; margin-bottom: 20px; }
        .lf-tab { flex: 1; text-align: center; padding: 8px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; color: var(--text-muted); }
        .lf-tab.active { background: var(--bg-body); color: var(--text-main); font-weight: 600; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .lf-item {
            display: flex; gap: 15px; padding: 15px; background: var(--bg-surface);
            border-radius: var(--radius-md); margin-bottom: 15px; border: 1px solid var(--border-color);
        }
        .lf-img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; background: #333; }
        .lf-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: 700; }
        .lf-lost { color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .lf-found { color: var(--accent); background: rgba(16, 185, 129, 0.1); }

        /* --- NEW MODULE CSS --- */
        /* Social */
        .story-ring {
            width: 60px; height: 60px; border-radius: 50%; padding: 3px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            margin-bottom: 5px; position: relative;
        }
        .story-ring.seen { background: var(--border-color); }
        .story-img { width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--bg-body); object-fit: cover; }
        .social-post { background: var(--bg-surface); border-radius: var(--radius-md); padding: 15px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        
        /* Wellness */
        .fitness-ring-container { position: relative; width: 120px; height: 120px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        .fitness-ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .fitness-circle-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
        .fitness-circle-fg { fill: none; stroke: var(--accent); stroke-width: 8; stroke-dasharray: 283; stroke-dashoffset: 70; transition: stroke-dashoffset 1s ease; stroke-linecap: round; }
        .fitness-stats { display: flex; justify-content: space-around; text-align: center; margin-top: 20px; }
        
        /* Admin */
        .id-card {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 16px; padding: 20px; position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .id-card::before {
            content: ''; position: absolute; top: -50px; right: -50px; width: 150px; height: 150px;
            background: rgba(99, 102, 241, 0.1); border-radius: 50%; blur(40px);
        }
        .id-photo { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; border: 2px solid rgba(255,255,255,0.2); }
        .barcode { height: 30px; background: white; margin-top: 15px; opacity: 0.8; }

        /* Utilities */
        .utility-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-surface); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border-color); }

        /* Travel */
        .ride-card {
            background: var(--bg-surface); border-radius: var(--radius-lg); padding: 20px;
            margin-bottom: 15px; border: 1px solid var(--border-color); position: relative;
        }
        .ride-route { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .ride-time { font-size: 1.2rem; font-weight: 800; }
        .ride-meta { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-muted); }
        .seats-badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; }

        /* Nearby & Exchange */
        .vibe-tag { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; background: rgba(255,255,255,0.1); margin-right: 5px; margin-bottom: 5px; }
        .place-card { display: flex; gap: 15px; margin-bottom: 15px; background: var(--bg-surface); padding: 10px; border-radius: var(--radius-md); border: 1px solid var(--border-color); }
        .place-img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }
        .map-container { width: 100%; height: 300px; background: #222; border-radius: var(--radius-lg); position: relative; overflow: hidden; margin-bottom: 15px; }
        .map-marker { position: absolute; font-size: 1.5rem; color: var(--danger); transform: translate(-50%, -100%); cursor: pointer; }
        .exchange-card { background: var(--bg-surface); border: 1px solid var(--border-color); padding: 15px; border-radius: var(--radius-md); margin-bottom: 10px; }

        /* Academic Cockpit & LMS */
        .academic-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .academic-tabs::-webkit-scrollbar { display: none; }
        .academic-tab { padding: 8px 16px; border-radius: 20px; background: var(--bg-surface); border: 1px solid var(--border-color); white-space: nowrap; cursor: pointer; font-size: 0.9rem; color: var(--text-muted); transition: var(--transition); }
        .academic-tab.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 12px var(--primary-glow); }

        .timetable-slot { display: flex; gap: 15px; padding: 15px; background: var(--bg-surface); border-radius: var(--radius-md); border-left: 4px solid var(--border-color); margin-bottom: 10px; position: relative; transition: var(--transition); }
        .timetable-slot:active { transform: scale(0.98); }
        .slot-active { border-left-color: var(--accent); background: rgba(16, 185, 129, 0.05); }
        .slot-cancelled { opacity: 0.6; border-left-color: var(--danger); }
        .slot-time { min-width: 60px; display: flex; flex-direction: column; justify-content: center; font-weight: 700; font-size: 0.9rem; color: var(--text-muted); border-right: 1px solid var(--border-color); padding-right: 15px; }
        .slot-status { position: absolute; top: 10px; right: 10px; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
        .status-live { background: var(--accent); color: white; animation: pulse 2s infinite; }
        .status-cancelled { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .status-upcoming { background: rgba(99, 102, 241, 0.1); color: var(--primary); }

        .lms-course-card { background: var(--bg-surface); border-radius: var(--radius-md); padding: 15px; border: 1px solid var(--border-color); margin-bottom: 15px; position: relative; overflow: hidden; }
        .progress-bar { height: 6px; background: var(--bg-body); border-radius: 3px; overflow: hidden; margin-top: 15px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 3px; width: 0; transition: width 1s ease-out; }
        
        .assignment-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
        .assignment-item:last-child { border-bottom: none; }
        .assignment-icon { width: 32px; height: 32px; border-radius: 8px; background: rgba(99, 102, 241, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }

        .exam-card { background: linear-gradient(135deg, #1e293b, #0f172a); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; text-align: center; margin-bottom: 15px; position: relative; overflow: hidden; }
        .exam-timer { font-size: 2rem; font-weight: 800; margin: 15px 0; color: var(--primary); font-variant-numeric: tabular-nums; letter-spacing: 1px; }
        .exam-meta { display: flex; justify-content: center; gap: 15px; font-size: 0.85rem; color: var(--text-muted); }

        /* --- AI FEATURES STYLES --- */
        .pulse-btn {
            animation: pulse-ring 2s infinite;
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        .sentiment-bar {
            height: 10px; background: #333; border-radius: 5px; overflow: hidden; display: flex;
        }
        .sentiment-seg { height: 100%; transition: width 0.5s ease; }

        .scan-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9); z-index: 500;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .scan-frame {
            width: 80%; height: 60%; border: 2px solid var(--primary);
            position: relative; border-radius: 20px;
            box-shadow: 0 0 20px var(--primary-glow);
        }
        .scan-line {
            position: absolute; width: 100%; height: 2px; background: var(--accent);
            top: 0; animation: scan 2s infinite linear;
            box-shadow: 0 0 10px var(--accent);
        }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        /* --- LMS+ & AI STUDY STYLES --- */
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--bg-surface); border: 1px solid var(--border-color); padding: 15px; border-radius: var(--radius-md); text-align: center; }
        .stat-val { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.75rem; color: var(--text-muted); }
        
        .badge-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .badge-item { min-width: 80px; background: var(--bg-surface); padding: 10px; border-radius: var(--radius-md); text-align: center; border: 1px solid var(--border-color); }
        .badge-icon { font-size: 1.5rem; margin-bottom: 5px; }
        
        .timeline-item { border-left: 2px solid var(--border-color); padding-left: 15px; margin-left: 5px; padding-bottom: 20px; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: -6px; top: 0; width: 10px; height: 10px; border-radius: 50%; background: var(--primary); }
        .timeline-time { font-size: 0.75rem; color: var(--text-muted); }
        
        .ai-tool-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .ai-tool-card { background: rgba(99, 102, 241, 0.05); border: 1px solid var(--primary); padding: 15px; border-radius: var(--radius-md); text-align: center; cursor: pointer; transition: var(--transition); }
        .ai-tool-card:active { transform: scale(0.95); }
        
        .chart-bar-container { height: 100px; display: flex; align-items: flex-end; gap: 10px; padding: 10px 0; }
        .chart-bar { flex: 1; background: var(--bg-surface); border-radius: 4px; position: relative; transition: height 1s ease; }
        .chart-bar-fill { position: absolute; bottom: 0; left: 0; right: 0; background: var(--primary); border-radius: 4px; opacity: 0.7; }
        .chart-label { text-align: center; font-size: 0.6rem; margin-top: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* --- SAFETY & SECURITY --- */
        .sos-btn {
            width: 150px; height: 150px; border-radius: 50%; 
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white; font-size: 2rem; font-weight: 800;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 0 0 10px rgba(239, 68, 68, 0.2), 0 0 30px rgba(239, 68, 68, 0.5);
            animation: sos-pulse 1.5s infinite; cursor: pointer; border: none;
            margin: 20px auto;
        }
        @keyframes sos-pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .safety-option {
            background: var(--bg-surface); border: 1px solid var(--border-color);
            padding: 15px; border-radius: var(--radius-md); display: flex; align-items: center; gap: 15px;
            margin-bottom: 10px; cursor: pointer; transition: var(--transition);
        }
        .safety-option:active { transform: scale(0.98); }

        /* --- IOT & SETTINGS --- */
        .iot-card {
            background: var(--bg-surface); border: 1px solid var(--border-color);
            padding: 20px; border-radius: var(--radius-lg); margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .setting-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid var(--border-color);
        }
        .switch {
            position: relative; display: inline-block; width: 44px; height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--bg-body); transition: .4s; border-radius: 34px;
            border: 1px solid var(--border-color);
        }
        .slider:before {
            position: absolute; content: ""; height: 18px; width: 18px; left: 2px; bottom: 2px;
            background-color: var(--text-muted); transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary); border-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(20px); background-color: white; }

        /* --- ACCESSIBILITY --- */
        body.dyslexic-font { font-family: 'OpenDyslexic', 'Comic Sans MS', sans-serif !important; }
        body.high-contrast { 
            --bg-body: #000000; --bg-surface: #000000; --text-main: #ffffff; 
            --text-muted: #ffff00; --primary: #00ffff; --border-color: #ffffff;
        }

    </style>
</head>
<body data-theme="dark">

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle toast-icon"></i>
        <span id="toast-message">Action Successful</span>
    </div>

    <div class="app-container">
        
        <!-- Header -->
        <header>
            <div class="brand">Ropar Institute Portal.</div>
            <div class="header-actions">
                <div class="icon-btn" onclick="openVoiceCommand()">
                    <i class="fas fa-microphone" style="color:var(--primary);"></i>
                </div>
                <div class="icon-btn" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </div>
                <div class="icon-btn" onclick="router('safety')">
                    <i class="fas fa-shield-alt" style="color:var(--danger);"></i>
                </div>
                <div class="icon-btn" onclick="router('settings')">
                    <i class="fas fa-cog"></i>
                </div>
                <img src="https://picsum.photos/seed/user/100/100" class="avatar" style="width:40px; height:40px; border-radius:50%; object-fit:cover; cursor:pointer;" alt="Profile" onclick="router('profile')">
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Content injected via JS -->
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="router('dashboard')">
                <i class="fas fa-th-large"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="router('mess')">
                <i class="fas fa-utensils"></i>
                <span>Mess</span>
            </div>
            <div class="nav-item" onclick="router('mail')">
                <i class="fas fa-envelope"></i>
                <span>Mail AI</span>
            </div>
            <div class="nav-item" onclick="router('academics')">
                <i class="fas fa-book-open"></i>
                <span>Study</span>
            </div>
            <div class="nav-item" onclick="router('explore')">
                <i class="fas fa-compass"></i>
                <span>Explore</span>
            </div>
        </nav>

        <!-- AI Assistant FAB -->
        <div class="ai-fab" style="position: fixed; bottom: 100px; right: 20px; width: 56px; height: 56px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; box-shadow: 0 10px 25px var(--primary-glow); z-index: 90; cursor: pointer; animation: pulse 2s infinite;" onclick="openAIChat()">
            <i class="fas fa-sparkles"></i>
        </div>

    </div>

    <!-- Modal: Payment/Action -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modal-body">
                <!-- Dynamic Modal Content -->
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            user: { name: 'Alex', balance: 500.00, points: 1250 },
            theme: 'dark',
            currentView: 'dashboard',
            messTab: 'breakfast',
            lfTab: 'lost',
            exchangeTab: 'skills',
            academicTab: 'cockpit',
            filters: {
                mail: 'All',
                mailQuery: '',
                messVegOnly: false
            },
            settings: {
                font: 'Inter',
                highContrast: false,
                tts: false,
                lang: 'en'
            }
        };

        // --- Mock Data (Extended) ---
        const data = {
            // Academic Cockpit Data
            timetable: [
                { id: 1, day: 'Mon', time: '09:00', endTime: '10:30', code: 'CS301', name: 'Data Structures', room: 'LH-101', prof: 'Dr. Smith', status: 'completed', type: 'Lecture' },
                { id: 2, day: 'Mon', time: '11:00', endTime: '12:30', code: 'CS302', name: 'Algorithms', room: 'LH-102', prof: 'Dr. Jones', status: 'live', type: 'Lecture' },
                { id: 3, day: 'Mon', time: '14:00', endTime: '16:00', code: 'CS301-L', name: 'DS Lab', room: 'LAB-2', prof: 'Dr. Smith', status: 'upcoming', type: 'Lab' },
                { id: 4, day: 'Tue', time: '10:00', endTime: '11:30', code: 'MA201', name: 'Linear Algebra', room: 'LH-205', prof: 'Dr. White', status: 'cancelled', type: 'Lecture' }
            ],
            lms: {
                courses: [
                    { id: 'c1', code: 'CS301', name: 'Data Structures', progress: 75, announcements: 2, color: 'var(--primary)' },
                    { id: 'c2', code: 'CS302', name: 'Algorithms', progress: 45, announcements: 0, color: 'var(--secondary)' },
                    { id: 'c3', code: 'MA201', name: 'Linear Algebra', progress: 90, announcements: 1, color: 'var(--accent)' }
                ],
                assignments: [
                    { id: 'a1', course: 'CS301', title: 'Binary Trees Impl', due: 'Tomorrow, 11:59 PM', type: 'Code', status: 'pending' },
                    { id: 'a2', course: 'CS302', title: 'Complexity Analysis', due: 'In 3 Days', type: 'Theory', status: 'pending' },
                    { id: 'a3', course: 'MA201', title: 'Eigenvalues Quiz', due: 'Oct 30', type: 'Quiz', status: 'completed' }
                ]
            },
            exams: [
                { course: 'CS301', title: 'Mid-Semester Exam', date: '2026-03-15', time: '10:00 AM', room: 'Exam Hall A', duration: '2h' },
                { course: 'MA201', title: 'Quiz 2', date: '2026-03-18', time: '02:00 PM', room: 'LH-205', duration: '1h' }
            ],
            exchange: [
                { id: 1, type: 'skills', title: 'Python Tutoring', offer: 'Will teach Python basics', want: 'Guitar lessons', user: 'Rohan' },
                { id: 2, type: 'skills', title: 'Photography', offer: 'Event photography', want: 'Math help', user: 'Alice' },
                { id: 3, type: 'rentals', title: 'DSLR Camera', price: 'â‚¹500/day', user: 'PhotoClub' },
                { id: 4, type: 'groupbuy', title: 'Spotify Family Plan', price: 'â‚¹30/mo', slots: '2 spots left', user: 'MusicLvr' }
            ],
            nearby: [
                { id: 1, name: 'The Coffee Nook', type: 'Cafe', rating: 4.8, dist: '0.5km', tags: ['Study Friendly', 'Quiet', 'Good Wifi'], img: 'coffee' },
                { id: 2, name: 'Spice Route', type: 'Restaurant', rating: 4.5, dist: '1.2km', tags: ['Group Dining', 'Spicy', 'Budget'], img: 'food' },
                { id: 3, name: 'Sunset Point', type: 'Attraction', rating: 4.9, dist: '2km', tags: ['Date Spot', 'View', 'Nature'], img: 'nature' }
            ],
            map: [
                { id: 1, name: 'Library', x: 50, y: 40, type: 'Study' },
                { id: 2, name: 'Main Canteen', x: 30, y: 60, type: 'Food' },
                { id: 3, name: 'Sports Complex', x: 70, y: 20, type: 'Activity' }
            ],
            market: [
                { id: 1, title: 'Calculus Textbook', price: 3500, img: 'textbook', user: 'Sarah M.', condition: 'Like New' },
                { id: 2, title: 'Mechanical Keyboard', price: 6500, img: 'computer keyboard', user: 'Devon K.', condition: 'Used' },
                { id: 3, title: 'Study Lamp', price: 800, img: 'desk lamp', user: 'Amit S.', condition: 'Good' },
                { id: 4, title: 'Scientific Calc', price: 1200, img: 'calculator', user: 'Priya R.', condition: 'Old' },
            ],
            lostFound: [
                { id: 1, type: 'lost', item: 'Blue Water Bottle', location: 'Library 2nd Floor', date: '2 hrs ago', img: 'water bottle', status: 'Searching' },
                { id: 2, type: 'found', item: 'Car Keys (Honda)', location: 'Canteen', date: 'Yesterday', img: 'car keys', status: 'At Security' },
                { id: 3, type: 'lost', item: 'AirPods Case', location: 'Gym', date: 'Today', img: 'headphones', status: 'Searching' }
            ],
            travel: [
                { id: 1, from: 'Campus Gate 1', to: 'Airport Terminal 2', time: '5:30 PM', cost: 150, seats: 2, total_seats: 4, driver: 'Rahul (4.8â˜…)' },
                { id: 2, from: 'Hostel Block A', to: 'City Center Mall', time: '7:00 PM', cost: 40, seats: 1, total_seats: 3, driver: 'Sneha (4.9â˜…)' }
            ],
            food: [
                { id: 1, name: 'Campus Coffee', time: '15 min', tag: 'Pickup', img: 'coffee' },
                { id: 2, name: 'Taco Tuesday', time: '30 min', tag: 'Delivery', img: 'tacos' },
            ],
            events: [
                { id: 1, title: 'Neon Night Party', day: '12', month: 'OCT', location: 'Student Union' },
                { id: 2, title: 'Tech Career Fair', day: '15', month: 'OCT', location: 'Engineering Hall' },
            ],
            classes: [
                { id: 1, code: 'CS 101', name: 'Intro to Algo', time: '10:00 AM', room: 'Hall A' },
                { id: 2, code: 'HIS 204', name: 'Modern History', time: '02:00 PM', room: 'Room 304' },
            ],
            // NEW: Mess Data
            mess: {
                breakfast: [
                    { name: 'Poha', cal: '250 kcal', rating: 4.5, crowd: 'Low', allergens: 'None' },
                    { name: 'Bread Omelette', cal: '300 kcal', rating: 4.8, crowd: 'Med', allergens: 'Egg' },
                    { name: 'Corn Flakes', cal: '150 kcal', rating: 3.9, crowd: 'Low', allergens: 'Milk' }
                ],
                lunch: [
                    { name: 'Rajma Chawal', cal: '450 kcal', rating: 4.7, crowd: 'High', allergens: 'None' },
                    { name: 'Paneer Butter Masala', cal: '400 kcal', rating: 4.9, crowd: 'High', allergens: 'Dairy' },
                    { name: 'Mixed Veg', cal: '200 kcal', rating: 4.0, crowd: 'Low', allergens: 'None' }
                ],
                dinner: [
                    { name: 'Chole Bhature', cal: '600 kcal', rating: 4.8, crowd: 'Med', allergens: 'Gluten' },
                    { name: 'Dal Makhani', cal: '350 kcal', rating: 4.6, crowd: 'Low', allergens: 'Dairy' }
                ]
            },
            // NEW: AI Mail Data
            mails: [
                {
                    id: 1,
                    sender: 'Registrar Office',
                    subject: 'Urgent: Semester Fee Deadline',
                    category: 'urgent',
                    priority: 'High',
                    summary: 'Pay â‚¹45,000 fees by Oct 20th to avoid late fine.',
                    sentiment: 'negative',
                    deadline: 'Oct 20, 2023'
                },
                {
                    id: 2,
                    sender: 'Cultural Secretary',
                    subject: 'Diwali Fest Auditions',
                    category: 'event',
                    priority: 'Normal',
                    summary: 'Auditions for dance and drama start this Friday at 5 PM.',
                    sentiment: 'positive',
                    deadline: 'This Friday'
                },
                {
                    id: 3,
                    sender: 'Professor Sharma',
                    subject: 'Lecture Rescheduled',
                    category: 'academic',
                    priority: 'Normal',
                    summary: 'CS101 lecture moved from Monday to Wednesday.',
                    sentiment: 'neutral',
                    deadline: 'None'
                }
            ],
            // NEW: Utilities Data (Merged into main utilities object below)
            // NEW: Performance & AI Data
            performance: {
                gpa: 8.4,
                cgpa: 8.2,
                credits: { earned: 85, total: 120 },
                badges: [
                    { id: 1, name: 'Code Ninja', icon: 'fa-terminal', color: 'var(--primary)' },
                    { id: 2, name: 'Perfect Attendance', icon: 'fa-calendar-check', color: 'var(--accent)' },
                    { id: 3, name: 'Quiz Master', icon: 'fa-brain', color: 'var(--secondary)' }
                ],
                analytics: [
                    { course: 'CS301', score: 88, avg: 75 },
                    { course: 'CS302', score: 72, avg: 70 },
                    { course: 'MA201', score: 91, avg: 82 },
                    { course: 'ENG101', score: 85, avg: 80 }
                ],
                attendance: [
                    { course: 'CS301', attended: 26, total: 30, title: 'Data Structures' },
                    { course: 'CS302', attended: 18, total: 28, title: 'Algorithms' },
                    { course: 'MA201', attended: 29, total: 30, title: 'Linear Algebra' },
                    { course: 'ENG101', attended: 15, total: 25, title: 'Comm. Skills' }
                ]
            },
            aiStudy: {
                schedule: [
                    { time: '18:00', task: 'Review CS301 Trees', type: 'Revision' },
                    { time: '19:30', task: 'MA201 Practice Problems', type: 'Practice' },
                    { time: '21:00', task: 'Project Sync', type: 'Group Study' }
                ],
                topics: [
                    { name: 'Graph Theory', difficulty: 'High', prob: 85 },
                    { name: 'Dynamic Programming', difficulty: 'Med', prob: 60 },
                    { name: 'Vector Spaces', difficulty: 'Low', prob: 30 }
                ],
                flashcards: [
                    { id: 1, deck: 'DS Concepts', count: 24, mastery: 60 },
                    { id: 2, deck: 'Linear Algebra Formulae', count: 15, mastery: 80 }
                ]
            },
            // NEW: Campus Pulse & Anomaly
            aiPulse: {
                mood: 'Excited',
                score: 78, // 0-100
                trending: ['#NeonNight', '#ExamStress', '#HostelFood'],
                alerts: [
                    { type: 'anomaly', msg: 'Unusual price drop detected in "Calculus Textbook"', level: 'med' },
                    { type: 'fraud', msg: 'User "BadActor" flagged for spam', level: 'high' }
                ]
            },
            // --- NEW: Social, Wellness, Admin, Utilities Data ---
            social: {
                stories: [
                    { id: 1, user: 'ArtClub', img: 'art', seen: false },
                    { id: 2, user: 'Rahul', img: 'person', seen: false },
                    { id: 3, user: 'FestTeam', img: 'party', seen: true },
                    { id: 4, user: 'GymBro', img: 'fitness', seen: false }
                ],
                posts: [
                    { id: 1, user: 'TechSoc', avatar: 'tech', content: 'Hackathon registrations closing tonight! ðŸš€ #CodeNight', likes: 124, comments: 15, time: '2h ago' },
                    { id: 2, user: 'Sarah J.', avatar: 'sarah', content: 'Anyone want to form a study group for CS302? Meeting at Lib.', likes: 45, comments: 8, time: '4h ago' }
                ],
                clubs: [
                    { name: 'Robotics Club', members: 450, category: 'Tech' },
                    { name: 'DebSoc', members: 120, category: 'Arts' },
                    { name: 'Mountaineering', members: 85, category: 'Sports' }
                ],
                roommates: [
                    { id: 1, name: 'Rohan K.', year: '2nd Year', dept: 'CS', habits: ['Night Owl', 'Gamer', 'Messy'], match: 95, avatar: 'fas fa-user-astronaut' },
                    { id: 2, name: 'Amit S.', year: '2nd Year', dept: 'EE', habits: ['Early Bird', 'Studious', 'Clean'], match: 40, avatar: 'fas fa-user-graduate' },
                    { id: 3, name: 'Vikram', year: '3rd Year', dept: 'Mech', habits: ['Fitness', 'Gamer', 'Clean'], match: 80, avatar: 'fas fa-user-ninja' }
                ]
            },
            wellness: {
                steps: 8432,
                sleep: '7h 12m',
                water: 4, // glasses
                mood_history: ['Happy', 'Stressed', 'Neutral', 'Excited', 'Happy', 'Happy', 'Excited'],
                meditation: [
                    { title: 'Exam Focus', duration: '10 min' },
                    { title: 'Sleep Aid', duration: '20 min' },
                    { title: 'Morning Energy', duration: '5 min' }
                ]
            },
            admin: {
                id_card: { name: 'Alex Doe', id: '2023CS101', dept: 'Computer Science', valid_thru: 'May 2027', barcode: '||| |||| | ||' },
                library: {
                    checked_out: [
                        { title: 'Intro to Algorithms', due: 'In 2 days' },
                        { title: 'Design Patterns', due: 'In 5 days' }
                    ],
                    fees: 0
                },
                attendance: 87 // percentage
            },
            utilities: {
                wifi: { status: 'Good', speed: '50 Mbps', users: '120/200' },
                power: { status: 'Stable', outage: false },
                weather: { temp: '28Â°C', condition: 'Sunny' },
                emergency: { active: false },
                laundry: [
                    { machine: 'Washer 1', status: 'Available', time: '-' },
                    { machine: 'Washer 2', status: 'Busy', time: '12 min' },
                    { machine: 'Dryer 1', status: 'Busy', time: '5 min' }
                ],
                printers: [
                    { loc: 'Library L1', status: 'Online', queue: 2 },
                    { loc: 'Hostel A', status: 'Low Paper', queue: 0 }
                ],
                outages: [
                    { type: 'Power', loc: 'Block B', time: '2:00 PM - 3:00 PM', status: 'Scheduled' }
                ]
            },
            // --- NEW: Safety, Integrations, Analytics, IoT ---
            safety: {
                contacts: [
                    { name: 'Campus Security', phone: '112', type: 'Emergency' },
                    { name: 'Warden (Block A)', phone: '9876543210', type: 'Hostel' },
                    { name: 'Health Center', phone: '108', type: 'Medical' }
                ],
                walkRequests: [
                    { id: 1, user: 'Neha', from: 'Library', to: 'Hostel A', time: 'Now' }
                ]
            },
            complaints: {
                active: [
                    { id: 101, type: 'Maintenance', category: 'Plumbing', title: 'Leaking tap in Room 304', status: 'In Progress', date: 'Oct 24', img: 'tap' },
                    { id: 102, type: 'Cleanliness', category: 'Housekeeping', title: 'Dustbin overflow in Corridor', status: 'Submitted', date: 'Oct 25', img: null }
                ],
                categories: [
                    { name: 'Electrical', keywords: ['light', 'fan', 'power', 'switch', 'socket'] },
                    { name: 'Plumbing', keywords: ['water', 'tap', 'leak', 'pipe', 'flush'] },
                    { name: 'Internet', keywords: ['wifi', 'net', 'speed', 'connect'] },
                    { name: 'Furniture', keywords: ['chair', 'table', 'bed', 'door', 'lock'] },
                    { name: 'Housekeeping', keywords: ['dust', 'clean', 'garbage', 'trash', 'smell'] }
                ]
            },
            events: {
                upcoming: [
                    { id: 1, title: 'Tech Fest 2024', date: 'Nov 15', time: '10:00 AM', venue: 'Main Audi', registered: 450, capacity: 500, type: 'Tech' },
                    { id: 2, title: 'Music Night', date: 'Nov 18', time: '7:00 PM', venue: 'OAT', registered: 120, capacity: 300, type: 'Cultural' }
                ],
                venues: [
                    { name: 'Main Audi', capacity: 500, avgTurnout: 0.9 },
                    { name: 'OAT', capacity: 300, avgTurnout: 0.6 },
                    { name: 'Seminar Hall', capacity: 100, avgTurnout: 0.8 }
                ]
            },
            inventory: {
                items: [
                    { id: 1, name: 'Projector A1', category: 'Lab', status: 'Available', img: 'video' },
                    { id: 2, name: 'Arduino Kit', category: 'Electronics', status: 'Booked', due: 'Tomorrow', img: 'microchip' },
                    { id: 3, name: 'Badminton Set', category: 'Sports', status: 'Available', img: 'table-tennis' }
                ],
                myBookings: [
                    { id: 101, item: 'Laptop Stand', date: 'Oct 20', status: 'Returned' }
                ]
            },
            foodWaste: {
                logs: [
                    { id: 1, date: 'Yesterday', meal: 'Lunch', quantity: '5kg', status: 'Donated', ngo: 'FeedIndia' },
                    { id: 2, date: 'Today', meal: 'Breakfast', quantity: '2kg', status: 'Composted', ngo: '-' }
                ],
                ngos: [
                    { name: 'FeedIndia', distance: '2km', status: 'Accepting' },
                    { name: 'City Shelter', distance: '5km', status: 'Full' }
                ]
            },
            freelance: {
                profile: { name: 'Student', skills: ['Python', 'Design'], rating: 4.8, earnings: 4500 },
                tasks: [
                    { id: 1, title: 'Poster Design', price: 500, deadline: '2 Days', skills: ['Design'] },
                    { id: 2, title: 'Python Script', price: 800, deadline: '1 Day', skills: ['Python'] }
                ]
            },
            integrations: {
                google: { connected: true, email: 'student@gmail.com' },
                outlook: { connected: false },
                payments: { balance: 2450, cards: ['**** 4242'] }
            },
            iot: [
                { id: 1, name: 'Room 304 Lights', status: true, type: 'light' },
                { id: 2, name: 'AC Unit', status: false, type: 'ac', temp: 24 },
                { id: 3, name: 'Smart Lock', status: true, type: 'lock' }
            ],
            analytics: {
                screenTime: { daily: '4h 12m', weekly: '28h' },
                appUsage: [
                    { app: 'LMS', pct: 40 },
                    { app: 'Social', pct: 25 },
                    { app: 'Mess', pct: 15 }
                ],
                privacy: { location: true, dataSharing: false }
            }
        };

        // --- Helper: Format Currency ---
        const formatINR = (amount) => {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency', currency: 'INR', maximumFractionDigits: 0
            }).format(amount);
        };

        // --- Core Functions ---
        function init() { router('login'); }

        function handleLogin() {
            const id = document.getElementById('login-id').value;
            const pass = document.getElementById('login-pass').value;

            if (!id || !pass) {
                showToast('Please enter credentials');
                return;
            }

            // Professional logic: Accept any random login ID and password
            showToast('Authenticating...');
            setTimeout(() => {
                showToast('Welcome back, ' + id);
                state.user.name = id; // Set user name to login ID
                document.querySelector('.bottom-nav').style.display = 'flex'; // Show nav
                document.querySelector('header').style.display = 'flex'; // Show header
                document.querySelector('.ai-fab').style.display = 'flex'; // Show FAB
                router('dashboard');
            }, 1000);
        }

        function router(view) {
            state.currentView = view;
            
            // Hide/Show Navigation & Header based on view
            if (view === 'login') {
                document.querySelector('.bottom-nav').style.display = 'none';
                document.querySelector('header').style.display = 'none';
                document.querySelector('.ai-fab').style.display = 'none';
            } else {
                // Ensure they are visible if we navigate away from login
                // (Though usually handled in handleLogin, this is a safety net for deep links if any)
                document.querySelector('.bottom-nav').style.display = 'flex';
                document.querySelector('header').style.display = 'flex';
                document.querySelector('.ai-fab').style.display = 'flex';
            }
            
            // Update Navigation
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navMap = { 'dashboard': 0, 'mess': 1, 'mail': 2, 'academics': 3, 'explore': 4, 'market': 4, 'lostfound': 4, 'travel': 4, 'exchange': 4, 'nearby': 4, 'map': 4, 'roommates': 4, 'complaints': 4, 'events': 4, 'inventory': 4, 'foodwaste': 4, 'freelance': 4, 'utilities': -1, 'safety': -1, 'analytics': -1, 'settings': -1, 'profile': -1 };
            if (navMap[view] !== -1 && navMap[view] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[view]].classList.add('active');
            }

            const main = document.getElementById('main-content');
            main.innerHTML = '';
            main.classList.remove('fade-in');
            void main.offsetWidth;
            main.classList.add('fade-in');

            // Routes
            if (view === 'login') renderLogin();
            else if (view === 'dashboard') renderDashboard();
            else if (view === 'mess') renderMess();
            else if (view === 'mail') renderMail();
            else if (view === 'academics') renderAcademics();
            else if (view === 'explore') renderExplore();
            else if (view === 'social') renderSocial();
            else if (view === 'roommates') renderRoommateMatcher();
            else if (view === 'complaints') renderComplaints();
            else if (view === 'events') renderEvents();
            else if (view === 'inventory') renderInventory();
            else if (view === 'foodwaste') renderFoodWaste();
            else if (view === 'freelance') renderFreelance();
            else if (view === 'wellness') renderWellness();
            else if (view === 'admin') renderAdmin();
            else if (view === 'utilities') renderUtilities();
            else if (view === 'market') renderMarketplace();
            else if (view === 'lostfound') renderLostFound();
            else if (view === 'travel') renderTravel();
            else if (view === 'exchange') renderExchange();
            else if (view === 'nearby') renderNearby();
            else if (view === 'map') renderMap();
            else if (view === 'safety') renderSafety();
            else if (view === 'analytics') renderAnalytics();
            else if (view === 'settings') renderSettings();
            else if (view === 'profile') renderProfile();
        }

        // --- Renderers ---

        function renderLogin() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:80vh; text-align:center;">
                    <div style="width:80px; height:80px; background:linear-gradient(135deg, var(--primary), var(--secondary)); border-radius:20px; display:flex; align-items:center; justify-content:center; margin-bottom:20px; box-shadow:0 10px 30px var(--primary-glow);">
                        <i class="fas fa-university" style="font-size:2.5rem; color:white;"></i>
                    </div>
                    <h1 style="font-size:2rem; margin-bottom:10px; color:#ffffff; text-shadow:0 2px 4px rgba(0,0,0,0.3);">Ropar Institute Portal.</h1>
                    <p style="color:var(--text-muted); margin-bottom:40px;">Your Entire Campus. One App.</p>

                    <div class="card" style="width:100%; max-width:320px; padding:30px; border:1px solid var(--border-color); background:rgba(30, 41, 59, 0.5); backdrop-filter:blur(10px);">
                        <div style="text-align:left; margin-bottom:20px;">
                            <label style="font-size:0.8rem; font-weight:600; margin-bottom:5px; display:block; color:var(--text-muted);">University ID / Email</label>
                            <div style="position:relative;">
                                <i class="fas fa-user" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted);"></i>
                                <input type="text" id="login-id" class="search-input" placeholder="e.g. 2023CS101" style="width:100%; padding-left:35px; background:var(--bg-body); border:1px solid var(--border-color);">
                            </div>
                        </div>
                        <div style="text-align:left; margin-bottom:30px;">
                            <label style="font-size:0.8rem; font-weight:600; margin-bottom:5px; display:block; color:var(--text-muted);">Password</label>
                            <div style="position:relative;">
                                <i class="fas fa-lock" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted);"></i>
                                <input type="password" id="login-pass" class="search-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%; padding-left:35px; background:var(--bg-body); border:1px solid var(--border-color);">
                            </div>
                            <div style="text-align:right; margin-top:10px;">
                                <span style="font-size:0.75rem; color:var(--primary); cursor:pointer;" onclick="showToast('Reset link sent to email')">Forgot Password?</span>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="width:100%; justify-content:center; padding:12px;" onclick="handleLogin()">
                            Login <i class="fas fa-arrow-right" style="margin-left:10px;"></i>
                        </button>
                    </div>

                    <div style="margin-top:30px; font-size:0.8rem; color:var(--text-muted);">
                        New Student? <span style="color:var(--primary); cursor:pointer;" onclick="showToast('Please visit Admin Office to register')">Create Account</span>
                    </div>
                </div>
            `;
        }

        function renderExplore() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <h2 class="section-title">Campus Life</h2>
                    </div>
                    <div class="hub-grid">
                        <div class="hub-card" onclick="router('social')">
                            <i class="fas fa-users hub-icon" style="color:#e11d48;"></i>
                            <div class="hub-title">Community</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Clubs & Stories</div>
                        </div>
                        <div class="hub-card" onclick="router('roommates')">
                            <i class="fas fa-user-friends hub-icon" style="color:#8b5cf6;"></i>
                            <div class="hub-title">Roommates</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Match & Find</div>
                        </div>
                        <div class="hub-card" onclick="router('complaints')">
                            <i class="fas fa-tools hub-icon" style="color:#ef4444;"></i>
                            <div class="hub-title">Complaints</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Track Issues</div>
                        </div>
                        <div class="hub-card" onclick="router('events')">
                            <i class="fas fa-calendar-alt hub-icon" style="color:#db2777;"></i>
                            <div class="hub-title">Events</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Crowd & Fun</div>
                        </div>
                        <div class="hub-card" onclick="router('inventory')">
                            <i class="fas fa-boxes hub-icon" style="color:#0ea5e9;"></i>
                            <div class="hub-title">Inventory</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Book Items</div>
                        </div>
                        <div class="hub-card" onclick="router('foodwaste')">
                            <i class="fas fa-recycle hub-icon" style="color:#16a34a;"></i>
                            <div class="hub-title">Food Waste</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Track & Donate</div>
                        </div>
                        <div class="hub-card" onclick="router('freelance')">
                            <i class="fas fa-laptop-code hub-icon" style="color:#9333ea;"></i>
                            <div class="hub-title">Skill Hub</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Freelance</div>
                        </div>
                        <div class="hub-card" onclick="router('wellness')">
                            <i class="fas fa-heartbeat hub-icon" style="color:#10b981;"></i>
                            <div class="hub-title">Wellness</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Fit & Mindful</div>
                        </div>
                        <div class="hub-card" onclick="router('admin')">
                            <i class="fas fa-id-card hub-icon" style="color:#f59e0b;"></i>
                            <div class="hub-title">Services</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">ID & Library</div>
                        </div>
                        <div class="hub-card" onclick="router('utilities')">
                            <i class="fas fa-bolt hub-icon" style="color:#6366f1;"></i>
                            <div class="hub-title">Utilities</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Wifi & Laundry</div>
                        </div>
                        <div class="hub-card" onclick="router('market')">
                            <i class="fas fa-store hub-icon" style="color:#ea580c;"></i>
                            <div class="hub-title">Marketplace</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Buy & Sell</div>
                        </div>
                        <div class="hub-card" onclick="router('exchange')">
                            <i class="fas fa-sync-alt hub-icon" style="color:#14b8a6;"></i>
                            <div class="hub-title">Exchange</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Skills & Rentals</div>
                        </div>
                         <div class="hub-card" onclick="router('map')">
                            <i class="fas fa-map-marked-alt hub-icon" style="color:#3b82f6;"></i>
                            <div class="hub-title">Navigation</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Find Rooms & Bus</div>
                        </div>
                        <div class="hub-card" onclick="router('nearby')">
                            <i class="fas fa-street-view hub-icon" style="color:#d946ef;"></i>
                            <div class="hub-title">Nearby Hub</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Food & Fun</div>
                        </div>
                        <div class="hub-card" onclick="router('travel')">
                            <i class="fas fa-taxi hub-icon" style="color:#06b6d4;"></i>
                            <div class="hub-title">Travel Pool</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Share Cabs</div>
                        </div>
                        <div class="hub-card" onclick="router('lostfound')">
                            <i class="fas fa-search-location hub-icon" style="color:#f97316;"></i>
                            <div class="hub-title">Lost & Found</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Report Item</div>
                        </div>
                        <div class="hub-card" onclick="router('safety')">
                            <i class="fas fa-shield-alt hub-icon" style="color:#dc2626;"></i>
                            <div class="hub-title">Safety</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">SOS & Report</div>
                        </div>
                        <div class="hub-card" onclick="router('analytics')">
                            <i class="fas fa-chart-pie hub-icon" style="color:#84cc16;"></i>
                            <div class="hub-title">Analytics</div>
                            <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Insights & Stats</div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderSocial() {
            const main = document.getElementById('main-content');
            const storiesHtml = data.social.stories.map(s => `
                <div style="display:flex; flex-direction:column; align-items:center; min-width:70px; cursor:pointer;" onclick="showToast('Viewing Story...')">
                    <div class="story-ring ${s.seen ? 'seen' : ''}">
                        <img src="https://loremflickr.com/100/100/${s.img}?random=${s.id}" class="story-img">
                    </div>
                    <div style="font-size:0.75rem; margin-top:5px; max-width:70px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${s.user}</div>
                </div>
            `).join('');

            const postsHtml = data.social.posts.map(p => `
                <div class="social-post slide-up">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <img src="https://loremflickr.com/50/50/${p.avatar}?random=${p.id}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                        <div>
                            <div style="font-weight:600; font-size:0.9rem;">${p.user}</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">${p.time}</div>
                        </div>
                    </div>
                    <div style="font-size:0.95rem; line-height:1.5; margin-bottom:15px;">${p.content}</div>
                    <div style="display:flex; gap:20px; color:var(--text-muted); font-size:0.9rem;">
                        <span onclick="showToast('Liked!')"><i class="far fa-heart"></i> ${p.likes}</span>
                        <span><i class="far fa-comment"></i> ${p.comments}</span>
                        <span style="margin-left:auto;"><i class="far fa-share-square"></i></span>
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Community</h2>
                        </div>
                        <i class="fas fa-plus-circle" style="color:var(--primary); font-size:1.5rem;" onclick="showToast('Create Post')"></i>
                    </div>
                    
                    <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:15px; margin-bottom:10px;">
                        ${storiesHtml}
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                         <button class="btn btn-primary" style="flex:1; font-size:0.9rem;" onclick="showToast('Club Directory')"><i class="fas fa-users"></i> Clubs</button>
                         <button class="btn" style="flex:1; background:var(--bg-surface); font-size:0.9rem;" onclick="showToast('Mentorship Program')"><i class="fas fa-handshake"></i> Mentors</button>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Campus Feed</h3>
                    ${postsHtml}
                </section>
            `;
        }

        function renderRoommateMatcher() {
            const main = document.getElementById('main-content');
            
            const roommatesHtml = data.social.roommates.map(r => `
                <div class="card slide-up" style="margin-bottom:15px; padding:15px;">
                    <div style="display:flex; gap:15px; align-items:center;">
                        <div style="width:50px; height:50px; background:var(--surface); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:var(--text-light);">
                            <i class="${r.avatar}"></i>
                        </div>
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between;">
                                <h3 style="margin:0; font-size:1rem;">${r.name}</h3>
                                <span style="font-size:0.8rem; font-weight:700; color:${r.match >= 80 ? 'var(--accent)' : (r.match >= 50 ? 'var(--warning)' : 'var(--danger)')};">${r.match}% Match</span>
                            </div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:2px;">${r.year}, ${r.dept}</div>
                            <div style="display:flex; flex-wrap:wrap; gap:5px; margin-top:8px;">
                                ${r.habits.map(h => `<span style="font-size:0.7rem; padding:2px 8px; background:rgba(255,255,255,0.05); border-radius:10px;">${h}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button class="btn btn-primary" style="flex:1; justify-content:center; font-size:0.8rem; padding:8px;" onclick="showToast('Request Sent to ${r.name}')">Connect</button>
                        <button class="btn" style="flex:1; justify-content:center; font-size:0.8rem; padding:8px; background:rgba(255,255,255,0.05);" onclick="showToast('Profile Saved')">Save</button>
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Roommate Matcher</h2>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-bottom:20px; padding:20px; background:linear-gradient(135deg, var(--primary), #4f46e5); border:none;">
                        <h3 style="margin:0 0 10px; color:white; font-size:1.1rem;">Find Your Perfect Match</h3>
                        <p style="margin:0 0 15px; color:rgba(255,255,255,0.8); font-size:0.85rem;">Based on your lifestyle preferences: <strong>Night Owl, Gamer, Clean</strong></p>
                        <button class="btn" style="background:white; color:var(--primary); border:none; width:auto; padding:6px 12px; font-size:0.8rem;" onclick="showToast('Edit Preferences')">Update Profile</button>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Top Matches</h3>
                    ${roommatesHtml}
                </section>
            `;
        }

        function renderWellness() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Wellness</h2>
                        </div>
                    </div>

                    <div class="card" style="text-align:center; padding:30px 20px;">
                        <div class="fitness-ring-container">
                            <svg class="fitness-ring-svg">
                                <circle class="fitness-circle-bg" cx="60" cy="60" r="45"></circle>
                                <circle class="fitness-circle-fg" cx="60" cy="60" r="45"></circle>
                            </svg>
                            <div style="position:absolute; display:flex; flex-direction:column; align-items:center;">
                                <i class="fas fa-walking" style="font-size:1.5rem; color:var(--accent); margin-bottom:5px;"></i>
                                <span style="font-size:1.2rem; font-weight:800;">${data.wellness.steps}</span>
                                <span style="font-size:0.7rem; color:var(--text-muted);">STEPS</span>
                            </div>
                        </div>
                        <div class="fitness-stats">
                            <div>
                                <div style="font-size:1.1rem; font-weight:700;">${data.wellness.sleep}</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Sleep</div>
                            </div>
                            <div>
                                <div style="font-size:1.1rem; font-weight:700;">${data.wellness.water}/8</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Water</div>
                            </div>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin:20px 0 15px;">Mindfulness</h3>
                    <div style="display:grid; gap:10px;">
                        ${data.wellness.meditation.map(m => `
                            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:15px;" onclick="showToast('Playing ${m.title}')">
                                <div style="display:flex; align-items:center; gap:15px;">
                                    <div style="width:40px; height:40px; background:rgba(16, 185, 129, 0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--accent);">
                                        <i class="fas fa-play"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight:600;">${m.title}</div>
                                        <div style="font-size:0.75rem; color:var(--text-muted);">${m.duration} â€¢ Guided</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <button class="btn btn-primary" style="margin-top:20px;" onclick="showToast('Find Workout Partner')"><i class="fas fa-dumbbell"></i> Find Gym Buddy</button>
                </section>
            `;
        }

        function renderAdmin() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Services</h2>
                        </div>
                    </div>

                    <div class="id-card slide-up" onclick="showToast('QR Code Enlarged')">
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div>
                                <h3 style="margin:0; font-size:1.2rem;">Ropar Institute Portal ID</h3>
                                <div style="font-size:0.8rem; color:rgba(255,255,255,0.7); margin-bottom:15px;">Student Identity Card</div>
                                <div style="font-size:1.1rem; font-weight:700;">${data.admin.id_card.name}</div>
                                <div style="font-size:0.9rem;">${data.admin.id_card.id}</div>
                                <div style="font-size:0.8rem; opacity:0.8; margin-top:5px;">${data.admin.id_card.dept}</div>
                            </div>
                            <img src="https://picsum.photos/seed/user/100/100" class="id-photo">
                        </div>
                        <div style="margin-top:20px; display:flex; justify-content:space-between; align-items:end;">
                            <div style="font-size:0.7rem; opacity:0.6;">Valid Thru: ${data.admin.id_card.valid_thru}</div>
                            <div class="barcode" style="width:100px;"></div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Library Portal')">
                            <i class="fas fa-book" style="font-size:1.5rem; color:var(--primary); margin-bottom:10px;"></i>
                            <div style="font-weight:600;">Library</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">${data.admin.library.checked_out.length} Books Due</div>
                        </div>
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Fee Portal')">
                            <i class="fas fa-receipt" style="font-size:1.5rem; color:var(--accent); margin-bottom:10px;"></i>
                            <div style="font-weight:600;">Fees</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">No Dues</div>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Quick Actions</h3>
                    <div style="display:flex; flex-direction:column; gap:10px;">
                        <button class="btn" style="background:var(--bg-surface); border:1px solid var(--border-color); justify-content:flex-start;" onclick="showToast('Leave Application')"><i class="fas fa-calendar-minus" style="width:25px;"></i> Apply for Leave</button>
                        <button class="btn" style="background:var(--bg-surface); border:1px solid var(--border-color); justify-content:flex-start;" onclick="showToast('Scholarships')"><i class="fas fa-graduation-cap" style="width:25px;"></i> Scholarship Status</button>
                    </div>
                </section>
            `;
        }

        function renderExchange() {
            const main = document.getElementById('main-content');
            const currentTab = state.exchangeTab || 'skills';
            
            let filtered = [];
            if (currentTab === 'skills') filtered = data.exchange.filter(i => i.type === 'skills');
            else if (currentTab === 'rentals') filtered = data.exchange.filter(i => i.type === 'rentals');
            else filtered = data.exchange.filter(i => i.type === 'groupbuy');

            const listHtml = filtered.map(item => `
                <div class="exchange-card slide-up">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-weight:600; font-size:1rem;">${item.title}</span>
                        <span style="font-size:0.8rem; color:var(--accent);">${item.user}</span>
                    </div>
                    ${item.type === 'skills' ? `<div style="font-size:0.85rem; color:var(--text-muted);">Offering: ${item.offer}</div><div style="font-size:0.85rem; color:var(--text-muted);">Seeking: ${item.want}</div>` : ''}
                    ${item.type === 'rentals' ? `<div style="font-size:0.9rem; font-weight:700;">${item.price}</div>` : ''}
                    ${item.type === 'groupbuy' ? `<div style="font-size:0.9rem; font-weight:700;">${item.price}</div><div style="font-size:0.8rem; color:var(--primary);">${item.slots}</div>` : ''}
                    <button class="btn btn-primary" style="margin-top:10px; padding:5px 10px; font-size:0.8rem; width:auto;" onclick="showToast('Contacting ${item.user}...')">Connect</button>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Exchange</h2>
                        </div>
                        <i class="fas fa-plus-circle" style="color:var(--primary); font-size:1.5rem;" onclick="showToast('New Listing')"></i>
                    </div>
                    <div class="lf-tabs">
                        <div class="lf-tab ${currentTab === 'skills' ? 'active' : ''}" onclick="switchExchangeTab('skills')">Skills</div>
                        <div class="lf-tab ${currentTab === 'rentals' ? 'active' : ''}" onclick="switchExchangeTab('rentals')">Rentals</div>
                        <div class="lf-tab ${currentTab === 'groupbuy' ? 'active' : ''}" onclick="switchExchangeTab('groupbuy')">Group Buy</div>
                    </div>
                    ${listHtml}
                </section>
            `;
        }

        function switchExchangeTab(tab) {
            state.exchangeTab = tab;
            renderExchange();
        }

        function renderNearby() {
            const main = document.getElementById('main-content');
            const items = data.nearby.map(item => `
                <div class="place-card slide-up">
                    <img src="https://loremflickr.com/200/200/${item.img}?random=${item.id}" class="place-img">
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between;">
                            <div style="font-weight:600;">${item.name}</div>
                            <div style="font-size:0.8rem; background:var(--primary); padding:2px 6px; border-radius:4px;">${item.rating}â˜…</div>
                        </div>
                        <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:5px;">${item.type} â€¢ ${item.dist}</div>
                        <div>
                            ${item.tags.map(t => `<span class="vibe-tag">${t}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                     <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Nearby Hub</h2>
                        </div>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search cafes, spots...">
                    </div>
                    ${items}
                </section>
            `;
        }

        function renderMap() {
            const main = document.getElementById('main-content');
            const markers = data.map.map(m => `
                <div class="map-marker" style="left:${m.x}%; top:${m.y}%;" onclick="showToast('${m.name}')">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Smart Nav</h2>
                        </div>
                    </div>
                    <div class="map-container">
                        <!-- Simulated Map Background -->
                        <div style="width:100%; height:100%; opacity:0.3; background: repeating-linear-gradient(45deg, #333, #333 10px, #222 10px, #222 20px);"></div>
                        ${markers}
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <button class="btn btn-primary" onclick="showToast('AR Navigation Started')"><i class="fas fa-vr-cardboard"></i> Start AR</button>
                        <button class="btn" style="background:var(--bg-surface); border:1px solid var(--border-color);" onclick="showToast('Bus Tracking...')"><i class="fas fa-bus"></i> Bus Tracker</button>
                    </div>
                    <div style="margin-top:20px;">
                        <h4 style="margin-bottom:10px;">Crowd Density</h4>
                        <div style="background:var(--bg-surface); padding:10px; border-radius:var(--radius-md);">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                <span>Library</span>
                                <span style="color:var(--danger);">High</span>
                            </div>
                            <div style="height:4px; background:#333; border-radius:2px; overflow:hidden;">
                                <div style="width:80%; height:100%; background:var(--danger);"></div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderMarketplace() {
            const main = document.getElementById('main-content');
            const items = data.market.map(item => `
                <div class="market-item slide-up" onclick="showToast('Chat with ${item.user}')">
                    <div class="market-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <div class="market-info">
                        <div class="market-title">${item.title}</div>
                        <div class="market-meta">
                            <span class="market-condition">${item.condition}</span>
                            <span><i class="fas fa-user-circle"></i> ${item.user}</span>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div class="market-price">${formatINR(item.price)}</div>
                        <div style="font-size:0.7rem; color:var(--text-muted); margin-top:2px;">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Marketplace</h2>
                        </div>
                        <button class="btn btn-primary" style="width:auto; padding:8px 15px; font-size:0.8rem;" onclick="showToast('Listing Form Opened')"><i class="fas fa-plus"></i> Sell</button>
                    </div>
                    
                    ${data.aiPulse.alerts.map(alert => `
                        <div class="card slide-up" style="background:rgba(239, 68, 68, 0.1); border:1px solid var(--danger); margin-bottom:15px; display:flex; gap:10px; align-items:center;">
                            <i class="fas fa-shield-alt" style="color:var(--danger); font-size:1.2rem;"></i>
                            <div>
                                <div style="font-weight:700; font-size:0.8rem; color:var(--danger); text-transform:uppercase;">AI Security Alert</div>
                                <div style="font-size:0.8rem; color:var(--text-main);">${alert.msg}</div>
                            </div>
                        </div>
                    `).join('')}

                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Find books, gadgets...">
                    </div>
                    <div class="market-list">
                        ${items}
                    </div>
                </section>
            `;
        }

        function renderLostFound() {
            const main = document.getElementById('main-content');
            const currentTab = state.lfTab || 'lost';
            
            const filtered = data.lostFound.filter(i => i.type === currentTab);
            const listHtml = filtered.length ? filtered.map(item => `
                <div class="lf-item slide-up">
                    <img src="https://loremflickr.com/200/200/${item.img}?random=${item.id}" class="lf-img">
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <span class="lf-tag ${item.type === 'lost' ? 'lf-lost' : 'lf-found'}">${item.type.toUpperCase()}</span>
                            <span style="font-size:0.75rem; color:var(--text-muted);">${item.date}</span>
                        </div>
                        <div style="font-weight:600; margin-bottom:2px;">${item.item}</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);"><i class="fas fa-map-marker-alt"></i> ${item.location}</div>
                        <div style="margin-top:8px; font-size:0.8rem; color:var(--primary);">Status: ${item.status}</div>
                    </div>
                </div>
            `).join('') : `<div style="text-align:center; padding:30px; color:var(--text-muted);">No items reported.</div>`;

            main.innerHTML = `
                 <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Lost & Found</h2>
                        </div>
                        <i class="fas fa-camera" style="color:var(--primary); font-size:1.2rem;" onclick="showToast('AI Image Recognition...')"></i>
                    </div>

                    <div class="lf-tabs">
                        <div class="lf-tab ${currentTab === 'lost' ? 'active' : ''}" onclick="switchLFTab('lost')">Lost Items</div>
                        <div class="lf-tab ${currentTab === 'found' ? 'active' : ''}" onclick="switchLFTab('found')">Found Items</div>
                    </div>

                    <div id="lf-list">
                        ${listHtml}
                    </div>

                    <button class="btn btn-primary" style="margin-top:20px;" onclick="showToast('Report Form Opened')">Report Item</button>
                </section>
            `;
        }

        function switchLFTab(tab) {
            state.lfTab = tab;
            renderLostFound();
        }

        function renderTravel() {
            const main = document.getElementById('main-content');
            const rides = data.travel.map(ride => `
                <div class="ride-card slide-up">
                    <div class="ride-route">
                        <div>
                            <div style="font-size:0.8rem; color:var(--text-muted);">FROM</div>
                            <div style="font-weight:600;">${ride.from}</div>
                        </div>
                        <i class="fas fa-arrow-right" style="color:var(--text-muted);"></i>
                        <div style="text-align:right;">
                            <div style="font-size:0.8rem; color:var(--text-muted);">TO</div>
                            <div style="font-weight:600;">${ride.to}</div>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--border-color); padding-top:15px;">
                        <div class="ride-time"><i class="far fa-clock" style="font-size:1rem; color:var(--primary); margin-right:5px;"></i> ${ride.time}</div>
                        <div style="font-size:1.2rem; font-weight:700; color:var(--accent);">â‚¹${ride.cost}<span style="font-size:0.8rem; color:var(--text-muted); font-weight:400;">/person</span></div>
                    </div>
                    <div class="ride-meta" style="margin-top:15px;">
                        <div style="display:flex; align-items:center; gap:5px;">
                            <img src="https://picsum.photos/seed/${ride.driver}/50/50" style="width:20px; height:20px; border-radius:50%;">
                            <span>${ride.driver}</span>
                        </div>
                        <span class="seats-badge">${ride.seats}/${ride.total_seats} Seats Left</span>
                    </div>
                    <button class="btn" style="margin-top:15px; background:rgba(99, 102, 241, 0.1); color:var(--primary); border:none;" onclick="showToast('Joined Ride Request Sent')">Join Ride</button>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Cab Pool</h2>
                        </div>
                         <button class="btn btn-primary" style="width:auto; padding:8px 15px; font-size:0.8rem;" onclick="showToast('Create Ride')"><i class="fas fa-plus"></i> Offer</button>
                    </div>
                    
                    <div style="background:var(--bg-surface); padding:15px; border-radius:var(--radius-md); margin-bottom:20px; border:1px solid var(--border-color);">
                        <div style="font-size:0.85rem; color:var(--text-muted); margin-bottom:10px;">Where are you going?</div>
                        <div style="display:flex; gap:10px;">
                            <input type="text" class="search-input" placeholder="Destination..." style="margin:0;">
                            <button class="btn btn-primary" style="width:50px;"><i class="fas fa-search"></i></button>
                        </div>
                    </div>

                    ${rides}
                </section>
            `;
        }

        function renderDashboard() {
            const main = document.getElementById('main-content');
            
            // Quick Utility Preview
            const utilityPreview = `
                <div class="utility-card-grid slide-up">
                    <div class="utility-card" onclick="router('utilities')">
                        <i class="fas fa-wifi" style="color:${data.utilities.wifi.status === 'Good' ? 'var(--accent)' : 'var(--danger)'}; font-size:1.2rem; margin-bottom:5px;"></i>
                        <div style="font-weight:600; font-size:0.9rem;">Campus WiFi</div>
                        <div style="font-size:0.75rem; color:var(--text-muted);">${data.utilities.wifi.speed}</div>
                    </div>
                    <div class="utility-card" onclick="router('mess')">
                        <i class="fas fa-utensils" style="color:var(--primary); font-size:1.2rem; margin-bottom:5px;"></i>
                        <div style="font-weight:600; font-size:0.9rem;">Mess Live</div>
                        <div style="font-size:0.75rem; color:var(--text-muted);">Lunch: High Crowd</div>
                    </div>
                </div>
            `;

            // Quick Grub
            const activitiesHtml = data.food.map(item => `
                <div class="card" style="display:flex; align-items:center; gap:15px; padding:15px;" onclick="showToast('Ordering from ${item.name}...')">
                    <img src="https://loremflickr.com/200/200/${item.img}?random=${item.id}" style="width:60px; height:60px; border-radius:12px; object-fit:cover;">
                    <div><h4 style="margin:0;">${item.name}</h4><span class="food-tag">${item.tag} â€¢ ${item.time}</span></div>
                    <i class="fas fa-chevron-right" style="margin-left:auto; color:var(--text-muted)"></i>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search everything..." onkeyup="handleSearch(this.value)">
                    </div>

                    <!-- Balance Card -->
                    <div class="card balance-card slide-up">
                        <div class="balance-label">UniWallet Balance</div>
                        <div class="balance-amount">${formatINR(state.user.balance)}</div>
                        <div style="display:flex; gap:10px; margin-top:15px;">
                            <button class="btn" style="background:rgba(255,255,255,0.2); border:none; color:white; flex:1;" onclick="openAddFunds()"><i class="fas fa-plus"></i> Add</button>
                            <button class="btn" style="background:rgba(255,255,255,0.2); border:none; color:white; flex:1;" onclick="showToast('Scan QR')"><i class="fas fa-qrcode"></i> Pay</button>
                        </div>
                    </div>

                    ${utilityPreview}

                    <div class="card slide-up">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:1rem;">Campus Pulse <span style="font-size:0.7rem; background:rgba(236, 72, 153, 0.2); color:var(--secondary); padding:2px 6px; border-radius:4px;">LIVE AI</span></h3>
                            <div style="text-align:right;">
                                <div style="font-size:1.2rem; font-weight:800; color:var(--secondary);">${data.aiPulse.mood}</div>
                            </div>
                        </div>
                        <div class="sentiment-bar" style="margin:15px 0;">
                            <div class="sentiment-seg" style="width:78%; background:var(--secondary);"></div>
                            <div class="sentiment-seg" style="width:22%; background:rgba(255,255,255,0.1);"></div>
                        </div>
                        <div style="display:flex; gap:5px; flex-wrap:wrap;">
                            ${data.aiPulse.trending.map(t => `<span class="mail-chip" style="font-size:0.7rem;">${t}</span>`).join('')}
                        </div>
                    </div>

                    <div class="section-header">
                        <h3 class="section-title">AI Mail Insights</h3>
                        <a href="#" onclick="router('mail'); return false;" style="color:var(--primary); text-decoration:none; font-size:0.9rem;">View Inbox</a>
                    </div>
                    
                    <div class="card slide-up" style="border-left: 4px solid var(--danger);">
                        <div style="display:flex; justify-content:space-between;">
                            <div>
                                <h4 style="margin:0 0 5px;">${data.mails[0].subject}</h4>
                                <div style="font-size:0.85rem; color:var(--text-muted);">From: ${data.mails[0].sender}</div>
                            </div>
                            <span class="priority-badge prio-urgent">URGENT</span>
                        </div>
                        <div style="margin-top:10px; font-size:0.9rem; color:var(--text-main);">
                            ${data.mails[0].summary}
                        </div>
                    </div>

                    <div class="section-header" style="margin-top:20px;">
                        <h3 class="section-title">Upcoming Events</h3>
                    </div>
                    ${data.events.upcoming.map(e => {
                        const parts = e.date.split(' ');
                        const month = parts[0];
                        const day = parts[1] || ''; 
                        return `
                        <div class="card" style="display:flex; gap:15px; align-items:center;">
                            <div class="event-date" style="background:var(--bg-body); padding:10px; border-radius:12px; text-align:center; min-width:60px; border:1px solid var(--border-color);">
                                <span class="event-day" style="display:block; font-weight:800; font-size:1.2rem; color:var(--secondary);">${day}</span>
                                <span class="event-month" style="display:block; font-size:0.75rem; color:var(--text-muted); text-transform:uppercase;">${month}</span>
                            </div>
                            <div><h4 style="margin:0;">${e.title}</h4><small style="color:var(--text-muted)"><i class="fas fa-map-marker-alt"></i> ${e.venue}</small></div>
                        </div>
                    `}).join('')}
                </section>
            `;
        }

        function renderMess() {
            const main = document.getElementById('main-content');
            const currentTab = state.messTab || 'breakfast';

            // Filter Logic
            const meals = data.mess[currentTab].filter(item => {
                if (state.filters.messVegOnly) {
                    // Simple heuristic: if allergen is Egg/Chicken/Fish, it's non-veg
                    const nonVegAllergens = ['Egg', 'Chicken', 'Fish', 'Meat'];
                    if (nonVegAllergens.some(a => item.allergens.includes(a))) return false;
                }
                return true;
            });
            
            const mealListHtml = meals.length ? meals.map(item => `
                <div class="meal-item">
                    <div>
                        <div style="font-weight:600; font-size:0.95rem;">
                            <span style="width:10px; height:10px; display:inline-block; border-radius:50%; background:${item.allergens.includes('Egg') ? '#ef4444' : '#10b981'}; margin-right:5px;"></span>
                            ${item.name}
                        </div>
                        <div style="font-size:0.75rem; color:var(--text-muted); display:flex; align-items:center; gap:10px; margin-top:2px;">
                            <span><i class="fas fa-fire"></i> ${item.cal}</span>
                            <span style="color:${item.allergens === 'None' ? 'var(--accent)' : 'var(--danger)'}"><i class="fas fa-exclamation-triangle"></i> ${item.allergens}</span>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div class="rating-stars">${'<i class="fas fa-star"></i>'.repeat(Math.floor(item.rating))}</div>
                        <div style="font-size:0.7rem; margin-top:2px;">
                            Crowd: 
                            <span class="crowd-indicator ${item.crowd === 'High' ? 'crowd-high' : 'crowd-low'}">${item.crowd}</span>
                        </div>
                    </div>
                </div>
            `).join('') : '<div style="padding:20px; text-align:center; color:var(--text-muted);">No meals match your filters.</div>';

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <h2 class="section-title">Live Mess Menu</h2>
                        <div style="display:flex; align-items:center; gap:10px;">
                             <label style="font-size:0.8rem; display:flex; align-items:center; gap:5px; cursor:pointer;">
                                <input type="checkbox" ${state.filters.messVegOnly ? 'checked' : ''} onchange="toggleMessFilter(this.checked)"> Veg Only
                            </label>
                            <i class="fas fa-filter" style="color:var(--primary); cursor:pointer;" onclick="showToast('Advanced filters coming soon')"></i>
                        </div>
                    </div>

                    <div class="mess-tabs">
                        <div class="mess-tab ${currentTab === 'breakfast' ? 'active' : ''}" onclick="switchMessTab('breakfast')">Breakfast</div>
                        <div class="mess-tab ${currentTab === 'lunch' ? 'active' : ''}" onclick="switchMessTab('lunch')">Lunch</div>
                        <div class="mess-tab ${currentTab === 'dinner' ? 'active' : ''}" onclick="switchMessTab('dinner')">Dinner</div>
                    </div>

                    <div class="card slide-up" style="padding: 15px;">
                        <div id="mess-content">
                            ${mealListHtml}
                        </div>
                    </div>

                    <div class="card" style="background: linear-gradient(90deg, #1e293b, #0f172a); border: 1px solid var(--primary);">
                        <h4 style="margin:0 0 5px; color:white;">Today's Recommendation</h4>
                        <p style="margin:0; font-size:0.85rem; color:var(--text-muted);">Based on your high protein preference, try the <b>${currentTab === 'breakfast' ? 'Bread Omelette' : 'Paneer Butter Masala'}</b>!</p>
                    </div>
                </section>
            `;
        }

        function switchMessTab(type) {
            state.messTab = type;
            renderMess();
        }

        function toggleMessFilter(isVegOnly) {
            state.filters.messVegOnly = isVegOnly;
            renderMess();
        }

        function renderMail() {
            const main = document.getElementById('main-content');
            
            const filteredMails = data.mails.filter(mail => {
                const matchesCategory = state.filters.mail === 'All' || mail.category.toLowerCase() === state.filters.mail.toLowerCase();
                const matchesQuery = state.filters.mailQuery === '' || 
                                     mail.subject.toLowerCase().includes(state.filters.mailQuery.toLowerCase()) ||
                                     mail.sender.toLowerCase().includes(state.filters.mailQuery.toLowerCase()) ||
                                     mail.summary.toLowerCase().includes(state.filters.mailQuery.toLowerCase());
                return matchesCategory && matchesQuery;
            });

            const mailHtml = filteredMails.length ? filteredMails.map(mail => `
                <div class="card slide-up" style="padding: 15px; border-left: 4px solid ${mail.category === 'urgent' ? 'var(--danger)' : 'var(--primary)'};">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <div style="font-weight:700; font-size:0.95rem;">${mail.sender}</div>
                            <div style="font-size:0.85rem; margin-top:2px;">${mail.subject}</div>
                        </div>
                        <span class="priority-badge ${mail.priority === 'High' ? 'prio-urgent' : 'prio-normal'}">${mail.priority}</span>
                    </div>
                    
                    <div style="background:rgba(99, 102, 241, 0.05); padding:10px; border-radius:8px; margin:10px 0; border:1px dashed var(--primary);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:3px;">
                            <div style="font-size:0.7rem; color:var(--primary); font-weight:700; text-transform:uppercase;">AI Summary</div>
                            <div style="font-size:0.7rem; color:var(--text-muted); cursor:pointer;" onclick="showToast('Action item added to tasks')"><i class="fas fa-check-circle"></i> Add Task</div>
                        </div>
                        <div style="font-size:0.85rem; color:var(--text-main); line-height:1.4;">${mail.summary}</div>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; font-size:0.75rem; color:var(--text-muted);">
                        <span><i class="far fa-clock"></i> ${mail.deadline}</span>
                        <span>Sentiment: ${mail.sentiment}</span>
                    </div>
                </div>
            `).join('') : `<div style="text-align:center; padding:40px; color:var(--text-muted);">No emails found matching '${state.filters.mailQuery}' in '${state.filters.mail}'</div>`;

            const chips = ['All', 'Urgent', 'Academic', 'Event'];
            const chipsHtml = chips.map(c => 
                `<div class="mail-chip ${state.filters.mail === c ? 'active' : ''}" onclick="setMailFilter('${c}')">${c}</div>`
            ).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <h2 class="section-title">Inbox AI</h2>
                    </div>
                    
                    <div class="search-container" style="margin-bottom:15px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search inbox..." value="${state.filters.mailQuery}" oninput="searchMail(this.value)">
                    </div>

                    <div class="mail-filters">
                        ${chipsHtml}
                    </div>

                    <div id="mail-list">
                        ${mailHtml}
                    </div>
                </section>
            `;
        }

        function setMailFilter(category) {
            state.filters.mail = category;
            renderMail();
        }
        
        function searchMail(query) {
            state.filters.mailQuery = query;
            renderMail();
        }

        function renderUtilities() {
            const main = document.getElementById('main-content');
            
            const laundryHtml = data.utilities.laundry.map(m => `
                <div class="utility-item">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-tshirt" style="color:var(--text-muted);"></i>
                        <div>
                            <div style="font-weight:600; font-size:0.9rem;">${m.machine}</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Time Left: ${m.time}</div>
                        </div>
                    </div>
                    <span style="font-size:0.75rem; padding:2px 8px; border-radius:10px; background:${m.status === 'Available' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color:${m.status === 'Available' ? 'var(--accent)' : 'var(--danger)'};">${m.status}</span>
                </div>
            `).join('');

            const printerHtml = data.utilities.printers.map(p => `
                <div class="utility-item">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-print" style="color:var(--text-muted);"></i>
                        <div>
                            <div style="font-weight:600; font-size:0.9rem;">${p.loc}</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Queue: ${p.queue} docs</div>
                        </div>
                    </div>
                    <span style="font-size:0.75rem; padding:2px 8px; border-radius:10px; background:rgba(99, 102, 241, 0.1); color:var(--primary);">${p.status}</span>
                </div>
            `).join('');

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Utilities</h2>
                        </div>
                    </div>

                    ${data.utilities.outages.map(o => `
                        <div class="card slide-up" style="background:rgba(245, 158, 11, 0.1); border:1px solid #f59e0b; margin-bottom:20px; display:flex; gap:10px; align-items:center;">
                            <i class="fas fa-exclamation-triangle" style="color:#f59e0b; font-size:1.2rem;"></i>
                            <div>
                                <div style="font-weight:700; font-size:0.8rem; color:#f59e0b; text-transform:uppercase;">${o.type} Outage Alert</div>
                                <div style="font-size:0.8rem; color:var(--text-main);">${o.loc} â€¢ ${o.time}</div>
                            </div>
                        </div>
                    `).join('')}

                    <h3 style="font-size:1rem; margin-bottom:15px;">Laundry Status</h3>
                    <div style="margin-bottom:20px;">
                        ${laundryHtml}
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Smart Printers</h3>
                    <div style="margin-bottom:20px;">
                        ${printerHtml}
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Facility Requests</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Maintenance Request')">
                            <i class="fas fa-tools" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:5px;"></i>
                            <div style="font-size:0.8rem;">Maintenance</div>
                        </div>
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Night Canteen Order')">
                            <i class="fas fa-utensils" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:5px;"></i>
                            <div style="font-size:0.8rem;">Night Canteen</div>
                        </div>
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Room Cleaning')">
                            <i class="fas fa-broom" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:5px;"></i>
                            <div style="font-size:0.8rem;">Cleaning</div>
                        </div>
                        <div class="card" style="text-align:center; padding:15px;" onclick="showToast('Water Can')">
                            <i class="fas fa-tint" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:5px;"></i>
                            <div style="font-size:0.8rem;">Water Supply</div>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px; margin-top:20px;">Campus Notices</h3>
                    <div class="card" style="padding:15px; margin-bottom:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <div style="font-weight:600; font-size:0.9rem;">Latest Updates</div>
                            <span style="font-size:0.8rem; color:var(--primary); cursor:pointer;">View All</span>
                        </div>
                        <div style="border-left:2px solid var(--primary); padding-left:10px; margin-bottom:10px;">
                            <div style="font-weight:600; font-size:0.9rem;">Library Closed</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Tomorrow for maintenance.</div>
                        </div>
                         <div style="border-left:2px solid var(--secondary); padding-left:10px;">
                            <div style="font-weight:600; font-size:0.9rem;">Vaccination Drive</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Health Center, 9 AM - 4 PM.</div>
                        </div>
                    </div>
                    
                    <!-- Emergency Alert Toggle (Simulation) -->
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:600;">Emergency Alerts</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Receive push notifications</div>
                        </div>
                        <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                            <input type="checkbox" checked style="opacity:0; width:0; height:0;">
                            <span style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:var(--accent); border-radius:34px; transition:.4s;"></span>
                            <span style="position:absolute; content:''; height:16px; width:16px; left:4px; bottom:4px; background-color:white; border-radius:50%; transition:.4s; transform:translateX(16px);"></span>
                        </label>
                    </div>
                </section>
            `;
        }

        function renderAcademics() {
            const main = document.getElementById('main-content');
            const currentTab = state.academicTab || 'cockpit';

            let contentHtml = '';
            if (currentTab === 'cockpit') contentHtml = renderAcademicCockpit();
            else if (currentTab === 'lms') contentHtml = renderLMSPlus();
            else if (currentTab === 'ai-study') contentHtml = renderAIStudy();
            else if (currentTab === 'performance') contentHtml = renderPerformance();
            else if (currentTab === 'attendance') contentHtml = renderAttendance();
            else if (currentTab === 'exams') contentHtml = renderExams();

            main.innerHTML = `
                <section>
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <h2 class="section-title">Academic Hub</h2>
                        </div>
                        <i class="fas fa-calendar-alt" style="color:var(--text-muted); cursor:pointer;" onclick="openCalendarModal()"></i>
                    </div>

                    <div class="academic-tabs">
                        <div class="academic-tab ${currentTab === 'cockpit' ? 'active' : ''}" onclick="switchAcademicTab('cockpit')">Cockpit</div>
                        <div class="academic-tab ${currentTab === 'lms' ? 'active' : ''}" onclick="switchAcademicTab('lms')">LMS+</div>
                        <div class="academic-tab ${currentTab === 'ai-study' ? 'active' : ''}" onclick="switchAcademicTab('ai-study')">AI Study</div>
                        <div class="academic-tab ${currentTab === 'attendance' ? 'active' : ''}" onclick="switchAcademicTab('attendance')">Attendance</div>
                        <div class="academic-tab ${currentTab === 'performance' ? 'active' : ''}" onclick="switchAcademicTab('performance')">Stats</div>
                        <div class="academic-tab ${currentTab === 'exams' ? 'active' : ''}" onclick="switchAcademicTab('exams')">Exams</div>
                    </div>

                    <div id="academic-content" class="fade-in">
                        ${contentHtml}
                    </div>
                </section>
            `;
        }

        function switchAcademicTab(tab) {
            state.academicTab = tab;
            renderAcademics();
        }

        function renderAcademicCockpit() {
            // Simulated Day: Monday
            const day = 'Mon'; 
            const slots = data.timetable.filter(s => s.day === day);
            
            const slotsHtml = slots.map(slot => `
                <div class="timetable-slot ${slot.status === 'live' ? 'slot-active' : ''} ${slot.status === 'cancelled' ? 'slot-cancelled' : ''}" onclick="showToast('${slot.name} Details')">
                    <div class="slot-time">
                        <span>${slot.time}</span>
                        <span style="font-weight:400; font-size:0.75rem; opacity:0.7;">${slot.endTime}</span>
                    </div>
                    <div style="flex:1;">
                        <div style="font-weight:700; font-size:1rem; margin-bottom:2px;">${slot.code}</div>
                        <div style="font-size:0.9rem;">${slot.name}</div>
                        <div style="font-size:0.8rem; color:var(--text-muted); margin-top:5px;">
                            <i class="fas fa-map-marker-alt"></i> ${slot.room} â€¢ ${slot.prof}
                        </div>
                    </div>
                    <div class="slot-status status-${slot.status}">
                        ${slot.status === 'live' ? '<i class="fas fa-circle" style="font-size:0.5rem; margin-right:4px;"></i> LIVE' : slot.status.toUpperCase()}
                    </div>
                </div>
            `).join('');

            return `
                <div style="margin-bottom:15px; font-weight:600; color:var(--text-muted);">Today, ${day}</div>
                ${slotsHtml}
                <button class="btn" style="margin-top:15px; border:1px dashed var(--border-color); color:var(--text-muted);" onclick="showToast('Full Calendar View')">View Full Week</button>
            `;
        }

        function renderLMSPlus() {
            const coursesHtml = data.lms.courses.map(c => `
                <div class="lms-course-card" onclick="showToast('${c.code} Course Page')">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3 style="margin:0; font-size:1.1rem;">${c.code}</h3>
                        ${c.announcements > 0 ? `<span class="badge" style="position:static; padding:2px 8px; border-radius:10px; font-size:0.7rem;">${c.announcements} NEW</span>` : ''}
                    </div>
                    <div style="font-size:0.9rem; color:var(--text-muted); margin-bottom:10px;">${c.name}</div>
                    <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:var(--text-muted);">
                        <span>Progress</span>
                        <span>${c.progress}%</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${c.progress}%; background:${c.color};"></div></div>
                    <div style="display:flex; gap:10px; margin-top:15px;">
                         <button class="btn" style="padding:5px; font-size:0.75rem;" onclick="showToast('Materials')"><i class="fas fa-folder"></i> Files</button>
                         <button class="btn" style="padding:5px; font-size:0.75rem;" onclick="showToast('Grades')"><i class="fas fa-chart-bar"></i> Grades</button>
                    </div>
                </div>
            `).join('');

            const assignmentsHtml = data.lms.assignments.map(a => `
                <div class="assignment-item">
                    <div class="assignment-icon"><i class="fas fa-${a.type === 'Code' ? 'code' : 'book'}"></i></div>
                    <div style="flex:1;">
                        <div style="font-weight:600; font-size:0.9rem;">${a.title}</div>
                        <div style="font-size:0.75rem; color:var(--text-muted);">${a.course} â€¢ Due ${a.due}</div>
                    </div>
                    <div style="text-align:right;">
                         <div style="font-size:0.75rem; margin-bottom:5px; color:${a.status === 'completed' ? 'var(--accent)' : 'var(--text-muted)'}">${a.status === 'completed' ? 'Submitted' : 'Pending'}</div>
                         ${a.status !== 'completed' ? `<button class="btn btn-primary" style="width:auto; padding:5px 10px; font-size:0.75rem;" onclick="showToast('Upload Submission')">Submit</button>` : ''}
                    </div>
                </div>
            `).join('');

            return `
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                     <button class="btn btn-primary" style="flex:1;" onclick="showToast('Post Update')"><i class="fas fa-bullhorn"></i> Announcement</button>
                     <button class="btn" style="flex:1; background:var(--bg-surface);" onclick="showToast('Create Assignment')"><i class="fas fa-plus"></i> Assignment</button>
                </div>

                <h3 style="font-size:1rem; margin-bottom:15px;">My Courses</h3>
                ${coursesHtml}
                
                <div class="card" style="margin-top:20px;">
                    <h3 style="font-size:1rem; margin-bottom:15px;">Assignments Tracker</h3>
                    ${assignmentsHtml}
                </div>
            `;
        }

        function renderAIStudy() {
            const scheduleHtml = data.aiStudy.schedule.map(s => `
                <div class="timeline-item">
                    <div class="timeline-time">${s.time}</div>
                    <div style="font-weight:600; font-size:0.9rem;">${s.task}</div>
                    <div style="font-size:0.75rem; color:var(--primary);">${s.type}</div>
                </div>
            `).join('');

            const toolsHtml = `
                <div class="ai-tool-grid">
                    <div class="ai-tool-card" onclick="showToast('Generating Study Plan...')">
                        <i class="fas fa-calendar-check" style="font-size:1.5rem; color:var(--primary); margin-bottom:10px;"></i>
                        <div style="font-size:0.85rem; font-weight:600;">Auto-Scheduler</div>
                    </div>
                    <div class="ai-tool-card" onclick="showToast('Predicting Exam Topics...')">
                        <i class="fas fa-crystal-ball" style="font-size:1.5rem; color:var(--secondary); margin-bottom:10px;"></i>
                        <div style="font-size:0.85rem; font-weight:600;">Topic Predictor</div>
                    </div>
                    <div class="ai-tool-card" onclick="showToast('Generating Flashcards...')">
                        <i class="fas fa-layer-group" style="font-size:1.5rem; color:var(--accent); margin-bottom:10px;"></i>
                        <div style="font-size:0.85rem; font-weight:600;">Flashcards AI</div>
                    </div>
                    <div class="ai-tool-card" onclick="showToast('Matching Study Group...')">
                        <i class="fas fa-users" style="font-size:1.5rem; color:#f59e0b; margin-bottom:10px;"></i>
                        <div style="font-size:0.85rem; font-weight:600;">Group Match</div>
                    </div>
                    <div class="ai-tool-card" onclick="openScanTool()">
                        <i class="fas fa-camera" style="font-size:1.5rem; color:var(--text-main); margin-bottom:10px;"></i>
                        <div style="font-size:0.85rem; font-weight:600;">Smart Scan</div>
                    </div>
                </div>
            `;

            return `
                 <div class="card" style="background:linear-gradient(135deg, var(--primary), #4f46e5); border:none;">
                    <h4 style="margin:0 0 5px; color:white;">Study Streak: 12 Days ðŸ”¥</h4>
                    <p style="margin:0; font-size:0.8rem; color:rgba(255,255,255,0.8);">You are in the top 5% of students!</p>
                </div>

                <h3 style="font-size:1rem; margin:20px 0 15px;">AI Tools</h3>
                ${toolsHtml}

                <h3 style="font-size:1rem; margin:20px 0 15px;">Grade Forecast</h3>
                <div class="card" style="padding:15px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-weight:600;">CS301 Final Grade</span>
                        <span style="color:var(--accent); font-weight:700;">A- (Predicted)</span>
                    </div>
                    <div style="height:6px; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden;">
                        <div style="width:85%; height:100%; background:linear-gradient(90deg, var(--secondary), var(--primary));"></div>
                    </div>
                    <div style="font-size:0.75rem; color:var(--text-muted); margin-top:5px;">Based on recent quiz performance & attendance</div>
                </div>

                <h3 style="font-size:1rem; margin:20px 0 15px;">Smart Schedule</h3>
                <div class="card" style="padding:20px;">
                    ${scheduleHtml}
                </div>
            `;
        }

        function renderAttendance() {
            const items = data.performance.attendance.map(sub => {
                const p = ((sub.attended / sub.total) * 100).toFixed(1);
                let statusMsg = '';
                let statusColor = '';
                
                if (p < 75) {
                    const needed = Math.ceil(3 * sub.total - 4 * sub.attended);
                    if (needed > 0) {
                        statusMsg = `âš ï¸ <strong>Shortage!</strong> Attend next <strong>${needed}</strong> classes to hit 75%.`;
                        statusColor = 'var(--danger)';
                    } else {
                        statusMsg = `âš ï¸ <strong>Shortage!</strong> Attend next class!`;
                        statusColor = 'var(--danger)';
                    }
                } else {
                    const margin = Math.floor((4 * sub.attended - 3 * sub.total) / 3);
                    if (margin > 0) {
                        statusMsg = `ðŸŽ‰ <strong>Safe Zone!</strong> You can skip <strong>${margin}</strong> classes.`;
                        statusColor = 'var(--accent)';
                    } else {
                        statusMsg = `âœ… <strong>On Track!</strong> Don't miss the next one.`;
                        statusColor = 'var(--warning)';
                    }
                }

                return `
                    <div class="card" style="margin-bottom:15px; padding:15px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <div>
                                <div style="font-weight:700; font-size:1rem;">${sub.course}</div>
                                <div style="font-size:0.8rem; color:var(--text-muted);">${sub.title}</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-weight:700; font-size:1.2rem; color:${p < 75 ? 'var(--danger)' : 'var(--accent)'};">${p}%</div>
                                <div style="font-size:0.7rem; color:var(--text-muted);">${sub.attended}/${sub.total} Classes</div>
                            </div>
                        </div>
                        <div class="progress-bar" style="height:8px; margin-bottom:10px;">
                            <div class="progress-fill" style="width:${p}%; background:${p < 75 ? 'var(--danger)' : 'var(--accent)'};"></div>
                        </div>
                        <div style="font-size:0.85rem; padding:10px; background:rgba(255,255,255,0.05); border-radius:8px; border-left:3px solid ${statusColor};">
                            ${statusMsg}
                        </div>
                        <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
                             <button class="btn" style="padding:5px 10px; font-size:0.7rem; background:rgba(255,255,255,0.1);" onclick="showToast('Marked Present for ${sub.course}')">+ Present</button>
                             <button class="btn" style="padding:5px 10px; font-size:0.7rem; background:rgba(255,255,255,0.1);" onclick="showToast('Marked Absent for ${sub.course}')">+ Absent</button>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div style="margin-bottom:15px;">
                    <h3 style="font-size:1rem; margin-bottom:5px;">Smart Attendance Helper</h3>
                    <p style="font-size:0.8rem; color:var(--text-muted);">Real-time tracking & skip calculator based on 75% rule.</p>
                </div>
                ${items}
            `;
        }

        function renderPerformance() {
            const badgesHtml = data.performance.badges.map(b => `
                <div class="badge-item">
                    <div class="badge-icon" style="color:${b.color};"><i class="fas ${b.icon}"></i></div>
                    <div style="font-size:0.7rem; font-weight:600;">${b.name}</div>
                </div>
            `).join('');

            const chartHtml = data.performance.analytics.map(a => `
                <div class="chart-bar">
                    <div class="chart-bar-fill" style="height:${a.score}%;"></div>
                    <div style="position:absolute; bottom:${a.avg}%; left:0; right:0; border-top:2px dashed rgba(255,255,255,0.5); height:0;"></div>
                    <div style="position:absolute; bottom:-20px; width:100%; text-align:center; font-size:0.6rem;">${a.course}</div>
                </div>
            `).join('');

            return `
                 <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-val">${data.performance.gpa}</div>
                        <div class="stat-label">SGPA</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val">${data.performance.cgpa}</div>
                        <div class="stat-label">CGPA</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val">${data.performance.credits.earned}</div>
                        <div class="stat-label">Credits Earned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val">#12</div>
                        <div class="stat-label">Class Rank</div>
                    </div>
                </div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="font-size:1rem; margin:0;">Performance Analytics</h3>
                        <button class="btn btn-primary" style="width:auto; padding:4px 10px; font-size:0.7rem;" onclick="openGPACalculator()">Calc GPA</button>
                    </div>
                    <div class="chart-bar-container">
                        ${chartHtml}
                    </div>
                    <div style="margin-top:25px; text-align:center; font-size:0.8rem; color:var(--text-muted);">
                        <span style="display:inline-block; width:10px; height:10px; background:var(--primary); margin-right:5px; border-radius:2px;"></span> You
                        <span style="display:inline-block; width:10px; height:2px; background:rgba(255,255,255,0.5); margin-left:10px; margin-right:5px; vertical-align:middle;"></span> Avg
                    </div>
                </div>

                <h3 style="font-size:1rem; margin:20px 0 15px;">Achievements</h3>
                <div class="badge-container">
                    ${badgesHtml}
                </div>
            `;
        }

        function renderExams() {
            return data.exams.map(e => `
                <div class="exam-card">
                    <h4 style="margin:0; color:white; opacity:0.9;">${e.title}</h4>
                    <div style="font-size:0.9rem; color:var(--primary); margin-top:5px;">${e.course}</div>
                    <div class="exam-timer">
                        <span style="color:white;">04</span>d : <span style="color:white;">12</span>h
                    </div>
                    <div class="exam-meta">
                        <span><i class="far fa-calendar"></i> ${e.date}</span>
                        <span><i class="far fa-clock"></i> ${e.time}</span>
                    </div>
                    <div style="margin-top:15px; font-size:0.8rem; background:rgba(255,255,255,0.1); display:inline-block; padding:4px 10px; border-radius:12px;">
                        <i class="fas fa-map-marker-alt"></i> ${e.room}
                    </div>
                </div>
            `).join('');
        }

        // --- Interactive Components ---
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (state.theme === 'dark') {
                state.theme = 'light';
                body.setAttribute('data-theme', 'light');
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                state.theme = 'dark';
                body.setAttribute('data-theme', 'dark');
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function openModal(contentHtml) {
            const overlay = document.getElementById('modal-overlay');
            document.getElementById('modal-body').innerHTML = contentHtml;
            overlay.classList.add('open');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('open');
        }

        function openAIChat() {
            openModal(`
                <div style="height:300px; display:flex; flex-direction:column;">
                    <div style="flex:1; background:var(--bg-body); border-radius:12px; padding:15px; overflow-y:auto; margin-bottom:15px; border:1px solid var(--border-color);">
                        <div style="background:var(--bg-surface); padding:10px; border-radius:10px; display:inline-block; margin-bottom:10px; max-width:80%;">
                            <small style="color:var(--primary); font-weight:600;">UniBot AI</small><br>
                            Hi Alex! I noticed you have a CS assignment due tomorrow. Do you need help finding study resources?
                        </div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" placeholder="Ask UniBot..." style="flex:1; background:var(--bg-body); border:1px solid var(--border-color); color:var(--text-main); padding:12px; border-radius:25px; outline:none;">
                        <button class="btn btn-primary" style="width:50px; border-radius:50%;"><i class="fas fa-arrow-up"></i></button>
                    </div>
                </div>
            `);
        }
        
        function openVoiceCommand() {
            openModal(`
                <div style="text-align:center; padding:20px;">
                    <div class="pulse-btn" style="width:80px; height:80px; background:var(--primary); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
                        <i class="fas fa-microphone" style="font-size:2rem; color:white;"></i>
                    </div>
                    <h3 style="margin-bottom:10px;">Listening...</h3>
                    <p style="color:var(--text-muted); font-size:0.9rem;">Try saying "Check Grades" or "Navigate to Mess"</p>
                    <div style="margin-top:20px; display:flex; justify-content:center; gap:10px;">
                         <button class="btn" style="width:auto; border:1px solid var(--border-color); background:transparent;" onclick="closeModal()">Cancel</button>
                    </div>
                </div>
            `);
            // Simulate voice recognition
            setTimeout(() => {
                closeModal();
                showToast('Navigating to Academic Hub...');
                router('academics');
            }, 3000);
        }

        function openScanTool() {
            const overlay = document.createElement('div');
            overlay.className = 'scan-overlay fade-in';
            overlay.innerHTML = `
                <div class="scan-frame">
                    <div class="scan-line"></div>
                </div>
                <div style="color:white; margin-top:20px; font-weight:600;">Align document within frame</div>
                <div style="color:rgba(255,255,255,0.7); font-size:0.8rem; margin-top:5px;">AI OCR Active</div>
                <button class="btn" style="width:auto; margin-top:30px; background:white; color:black;" onclick="this.parentElement.remove(); showToast('Text Extracted & Saved to Notes');">Capture</button>
            `;
            document.body.appendChild(overlay);
        }

        function openAddFunds() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 20px;">Add Funds</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;">
                        <div class="card" style="text-align:center; padding:15px; cursor:pointer; border:1px solid var(--primary); background:rgba(99, 102, 241, 0.1);">â‚¹500</div>
                        <div class="card" style="text-align:center; padding:15px; cursor:pointer;">â‚¹1,000</div>
                        <div class="card" style="text-align:center; padding:15px; cursor:pointer;">â‚¹2,000</div>
                        <div class="card" style="text-align:center; padding:15px; cursor:pointer;">Custom</div>
                    </div>
                    <button class="btn btn-primary" onclick="showToast('Deposit Request Sent'); closeModal();">Deposit</button>
                     <button class="btn" style="margin-top:10px; border:none; background:transparent;" onclick="closeModal()">Cancel</button>
                </div>
            `);
        }

        function handleSearch(query) {
            if (query.length > 2) {
                showToast(`Searching for "${query}"...`);
            }
        }

        function openGPACalculator() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">GPA Calculator</h3>
                    <div style="background:var(--bg-body); padding:15px; border-radius:12px; margin-bottom:15px; border:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:600; color:var(--text-muted); font-size:0.8rem;">
                            <span>Course</span>
                            <span>Credits</span>
                            <span>Grade</span>
                        </div>
                        <div id="gpa-rows">
                            ${[1,2,3,4].map(i => `
                                <div style="display:flex; gap:10px; margin-bottom:10px;">
                                    <input type="text" placeholder="Course ${i}" class="search-input" style="margin:0; padding:8px;">
                                    <input type="number" placeholder="Cr" class="search-input" style="margin:0; padding:8px; width:50px;">
                                    <select class="search-input" style="margin:0; padding:8px; width:70px;">
                                        <option value="10">O</option>
                                        <option value="9">A+</option>
                                        <option value="8">A</option>
                                        <option value="7">B+</option>
                                    </select>
                                </div>
                            `).join('')}
                        </div>
                        <button class="btn" style="width:100%; border:1px dashed var(--border-color); color:var(--text-muted);" onclick="showToast('Added Row')">+ Add Course</button>
                    </div>
                    <div style="text-align:center; margin-bottom:15px;">
                        <div style="font-size:0.9rem; color:var(--text-muted);">Estimated GPA</div>
                        <div style="font-size:2rem; font-weight:800; color:var(--primary);">8.65</div>
                    </div>
                    <button class="btn btn-primary" onclick="closeModal()">Close</button>
                </div>
            `);
        }

        function openCalendarModal() {
            // Combine assignments and exams for the calendar
            const events = [
                ...data.lms.assignments.map(a => ({ title: a.title, date: a.due, type: 'assignment', color: 'var(--primary)' })),
                ...data.exams.map(e => ({ title: e.title, date: e.date, type: 'exam', color: 'var(--secondary)' }))
            ].sort((a,b) => new Date(a.date) - new Date(b.date));

            const eventsHtml = events.map(e => `
                <div style="display:flex; gap:15px; padding:10px; border-bottom:1px solid var(--border-color);">
                    <div style="display:flex; flex-direction:column; align-items:center; min-width:50px;">
                        <div style="font-weight:700; font-size:1.1rem;">${e.date.split(' ')[0]}</div>
                        <div style="font-size:0.7rem; color:var(--text-muted);">${e.date.split(' ')[1]}</div>
                    </div>
                    <div style="flex:1;">
                        <div style="font-weight:600;">${e.title}</div>
                        <div style="font-size:0.75rem; color:${e.color}; text-transform:uppercase; font-weight:700;">${e.type}</div>
                    </div>
                </div>
            `).join('');

            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">Academic Calendar</h3>
                    <div style="background:var(--bg-body); border-radius:12px; overflow:hidden; border:1px solid var(--border-color);">
                        ${eventsHtml}
                    </div>
                    <button class="btn btn-primary" style="margin-top:15px;" onclick="closeModal()">Done</button>
                </div>
            `);
        }

        function toggleIoT(index) {
            data.iot[index].status = !data.iot[index].status;
            renderSettings();
            showToast(`${data.iot[index].name} ${data.iot[index].status ? 'On' : 'Off'}`);
        }

        function openAnonymousReport() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 10px;">Anonymous Report</h3>
                    <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:15px;">Your identity will be protected. Please describe the incident.</p>
                    <select class="search-input" style="width:100%; margin-bottom:10px; background:var(--bg-body);">
                        <option>Harassment</option>
                        <option>Discrimination</option>
                        <option>Safety Hazard</option>
                        <option>Other</option>
                    </select>
                    <textarea class="search-input" style="width:100%; height:100px; background:var(--bg-body); margin-bottom:15px;" placeholder="Describe details..."></textarea>
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <input type="file" id="report-evidence" style="display:none;">
                        <label for="report-evidence" class="btn" style="flex:1; background:var(--bg-body); border:1px dashed var(--border-color); color:var(--text-muted);"><i class="fas fa-paperclip"></i> Add Evidence</label>
                    </div>
                    <button class="btn btn-primary" onclick="showToast('Report Submitted securely'); closeModal();">Submit Report</button>
                    <button class="btn" style="margin-top:10px; background:transparent;" onclick="closeModal()">Cancel</button>
                </div>
            `);
        }

        function openSafeWalk() {
            openModal(`
                <div style="text-align:center;">
                    <div style="width:60px; height:60px; background:rgba(16, 185, 129, 0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px;">
                        <i class="fas fa-walking" style="font-size:1.5rem; color:var(--accent);"></i>
                    </div>
                    <h3 style="margin:0 0 10px;">Safe Walk Request</h3>
                    <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom:20px;">Share your location with a verified companion.</p>
                    
                    <div style="text-align:left; margin-bottom:15px;">
                        <label style="font-size:0.8rem; font-weight:600; margin-bottom:5px; display:block;">Destination</label>
                        <input type="text" class="search-input" placeholder="e.g. Hostel A" style="width:100%; background:var(--bg-body);">
                    </div>

                    <button class="btn btn-primary" onclick="showToast('Searching for nearby companions...'); closeModal();">Find Companion</button>
                    <button class="btn" style="margin-top:10px; border:1px solid var(--border-color); background:transparent;" onclick="showToast('Security notified'); closeModal();">Request Security Escort</button>
                </div>
            `);
        }

        function toggleCalendarSync(provider) {
            if (data.integrations[provider].connected) {
                if (confirm('Disconnect ' + provider + ' calendar?')) {
                    data.integrations[provider].connected = false;
                    renderSettings();
                    showToast(provider + ' Disconnected');
                }
            } else {
                showToast('Redirecting to ' + provider + ' login...');
                setTimeout(() => {
                    data.integrations[provider].connected = true;
                    if (provider === 'google') data.integrations[provider].email = 'student@gmail.com';
                    renderSettings();
                    showToast(provider + ' Connected');
                }, 1500);
            }
        }

        function renderEvents() {
            const main = document.getElementById('main-content');
            
            const eventsHtml = data.events.upcoming.map(e => {
                const fill = Math.min(100, Math.round((e.registered / e.capacity) * 100));
                let color = 'var(--success)';
                if (fill > 90) color = 'var(--danger)';
                else if (fill > 70) color = 'var(--warning)';

                return `
                <div class="card slide-up" style="margin-bottom:15px; padding:0; overflow:hidden;">
                    <div style="height:100px; background:linear-gradient(135deg, ${color}, #333); display:flex; align-items:flex-end; padding:15px; position:relative;">
                        <div style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); padding:4px 8px; border-radius:12px; font-size:0.7rem; color:white;">
                            <i class="fas fa-users"></i> ${e.registered} / ${e.capacity}
                        </div>
                        <h3 style="margin:0; color:white; text-shadow:0 2px 4px rgba(0,0,0,0.5);">${e.title}</h3>
                    </div>
                    <div style="padding:15px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.85rem; color:var(--text-muted);">
                            <span><i class="far fa-calendar"></i> ${e.date}, ${e.time}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${e.venue}</span>
                        </div>
                        <div style="margin-bottom:5px; display:flex; justify-content:space-between; font-size:0.75rem;">
                            <span>Crowd Level</span>
                            <span style="color:${color}; font-weight:700;">${fill}% Full</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill" style="width:${fill}%; background:${color};"></div></div>
                        <button class="btn btn-primary" style="width:100%; margin-top:15px; padding:10px;" onclick="showToast('Registered for ${e.title}')">Register Now</button>
                    </div>
                </div>
                `;
            }).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Campus Events</h2>
                        </div>
                        <i class="fas fa-filter" style="color:var(--text-muted);"></i>
                    </div>

                    <div style="margin-bottom:20px; display:flex; gap:10px; overflow-x:auto; padding-bottom:5px;">
                         <div class="badge" style="background:var(--primary); color:white;">All</div>
                         <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Tech</div>
                         <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Cultural</div>
                         <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Sports</div>
                    </div>

                    ${eventsHtml}

                    <button class="fab" onclick="openEventPlanner()">
                        <i class="fas fa-plus"></i>
                    </button>
                </section>
            `;
        }

        function openEventPlanner() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">Plan Event & Estimate Crowd</h3>
                    
                    <input type="text" id="evt-title" class="search-input" placeholder="Event Title" style="width:100%; margin-bottom:10px; background:var(--bg-body);">
                    
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                         <select id="evt-venue" class="search-input" style="flex:1; background:var(--bg-body);" onchange="updateCrowdEstimate()">
                            ${data.events.venues.map(v => `<option value="${v.name}" data-cap="${v.capacity}">${v.name} (${v.capacity})</option>`).join('')}
                         </select>
                    </div>

                    <label style="font-size:0.8rem; font-weight:600; color:var(--text-muted);">Expected Audience</label>
                    <input type="number" id="evt-exp" class="search-input" placeholder="e.g. 200" style="width:100%; margin-bottom:15px; background:var(--bg-body);" oninput="updateCrowdEstimate()">

                    <div id="crowd-est" style="background:rgba(99, 102, 241, 0.1); padding:15px; border-radius:12px; margin-bottom:20px; display:none;">
                        <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:5px;">AI Crowd Prediction</div>
                        <div id="crowd-msg" style="font-weight:700; font-size:1rem; margin-bottom:5px;">Safe Capacity</div>
                        <div class="progress-bar"><div id="crowd-bar" class="progress-fill" style="width:0%;"></div></div>
                    </div>

                    <button class="btn btn-primary" onclick="submitEvent()">Create Event</button>
                </div>
            `);
        }

        function updateCrowdEstimate() {
            const venueEl = document.getElementById('evt-venue');
            const exp = parseInt(document.getElementById('evt-exp').value) || 0;
            const cap = parseInt(venueEl.options[venueEl.selectedIndex].getAttribute('data-cap'));
            
            const estEl = document.getElementById('crowd-est');
            const msgEl = document.getElementById('crowd-msg');
            const barEl = document.getElementById('crowd-bar');

            if (exp > 0) {
                estEl.style.display = 'block';
                const pct = Math.min(100, Math.round((exp / cap) * 100));
                barEl.style.width = pct + '%';
                
                if (pct > 100) {
                    msgEl.innerHTML = `<span style="color:var(--danger)">âš ï¸ Overcrowding Risk! (${pct}%)</span>`;
                    barEl.style.background = 'var(--danger)';
                } else if (pct > 80) {
                    msgEl.innerHTML = `<span style="color:var(--warning)">High Turnout Expected (${pct}%)</span>`;
                    barEl.style.background = 'var(--warning)';
                } else {
                    msgEl.innerHTML = `<span style="color:var(--success)">Safe Capacity (${pct}%)</span>`;
                    barEl.style.background = 'var(--success)';
                }
            } else {
                estEl.style.display = 'none';
            }
        }

        function submitEvent() {
            const title = document.getElementById('evt-title').value;
            const venue = document.getElementById('evt-venue').value;
            const exp = document.getElementById('evt-exp').value;

            if (!title || !exp) {
                showToast('Please fill all details');
                return;
            }

            const venueEl = document.getElementById('evt-venue');
            const cap = parseInt(venueEl.options[venueEl.selectedIndex].getAttribute('data-cap'));

            data.events.upcoming.push({
                id: Date.now(),
                title: title,
                date: 'Upcoming',
                time: 'TBA',
                venue: venue,
                registered: parseInt(exp), // Simulating registration = expectation
                capacity: cap,
                type: 'User Created'
            });

            closeModal();
            showToast('Event Created Successfully');
            renderEvents();
        }

        function renderInventory() {
            const main = document.getElementById('main-content');
            
            const itemsHtml = data.inventory.items.map(i => `
                <div class="card slide-up" style="display:flex; gap:15px; margin-bottom:15px;">
                    <div style="width:60px; height:60px; background:var(--bg-surface); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:var(--primary);">
                        <i class="fas fa-${i.img}"></i>
                    </div>
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <div style="font-weight:600;">${i.name}</div>
                            <span class="badge" style="background:${i.status === 'Available' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color:${i.status === 'Available' ? 'var(--accent)' : 'var(--danger)'}; font-size:0.7rem;">${i.status}</span>
                        </div>
                        <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">${i.category}</div>
                        ${i.status === 'Available' ? 
                            `<button class="btn btn-primary" style="padding:5px 15px; font-size:0.8rem;" onclick="bookItem(${i.id})">Book Now</button>` : 
                            `<div style="font-size:0.75rem; color:var(--text-muted);">Due: ${i.due}</div>`
                        }
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Inventory Booking</h2>
                        </div>
                        <i class="fas fa-history" style="color:var(--text-muted);"></i>
                    </div>

                    <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; margin-bottom:10px;">
                        <div class="badge" style="background:var(--primary); color:white;">All</div>
                        <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Lab</div>
                        <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Sports</div>
                        <div class="badge" style="background:var(--bg-surface); border:1px solid var(--border-color);">Electronics</div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Available Items</h3>
                    ${itemsHtml}

                    <div class="card" style="margin-top:20px; background:rgba(99, 102, 241, 0.1); border:1px solid var(--primary);">
                        <h3 style="font-size:1rem; margin:0 0 10px;">My Bookings</h3>
                        ${data.inventory.myBookings.map(b => `
                            <div style="display:flex; justify-content:space-between; font-size:0.85rem; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.1);">
                                <span>${b.item}</span>
                                <span style="color:var(--text-muted);">${b.status} (${b.date})</span>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function bookItem(id) {
            const item = data.inventory.items.find(i => i.id === id);
            if (item) {
                showToast(`Booking ${item.name}...`);
                setTimeout(() => {
                    item.status = 'Booked';
                    item.due = 'Tomorrow';
                    data.inventory.myBookings.unshift({
                        id: Date.now(),
                        item: item.name,
                        date: 'Just Now',
                        status: 'Active'
                    });
                    showToast('Booking Confirmed!');
                    renderInventory();
                }, 1000);
            }
        }

        function renderFoodWaste() {
            const main = document.getElementById('main-content');
            
            const logsHtml = data.foodWaste.logs.map(l => `
                <div class="card slide-up" style="margin-bottom:10px; padding:10px 15px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:600;">${l.meal} (${l.quantity})</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">${l.date} â€¢ ${l.status}</div>
                        </div>
                        ${l.status === 'Donated' ? 
                            `<span class="badge" style="background:rgba(34, 197, 94, 0.1); color:var(--success); font-size:0.7rem;">To: ${l.ngo}</span>` : 
                            `<span class="badge" style="background:rgba(234, 179, 8, 0.1); color:var(--warning); font-size:0.7rem;">Composted</span>`
                        }
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Zero Waste</h2>
                        </div>
                        <i class="fas fa-leaf" style="color:var(--success);"></i>
                    </div>

                    <div class="card" style="background:linear-gradient(135deg, var(--success), #14532d); color:white; border:none; margin-bottom:20px;">
                        <h3 style="margin:0 0 5px;">Food Saved</h3>
                        <div style="font-size:2.5rem; font-weight:800;">12 kg</div>
                        <p style="margin:0; opacity:0.8; font-size:0.8rem;">Equivalent to 40 meals donated this month!</p>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Nearby NGOs</h3>
                    <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; margin-bottom:10px;">
                        ${data.foodWaste.ngos.map(n => `
                            <div class="card" style="min-width:140px; padding:10px;">
                                <div style="font-weight:600; font-size:0.9rem;">${n.name}</div>
                                <div style="font-size:0.75rem; color:var(--text-muted); margin-bottom:5px;">${n.distance}</div>
                                <span class="badge" style="font-size:0.65rem; background:${n.status === 'Accepting' ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; color:${n.status === 'Accepting' ? 'var(--success)' : 'var(--danger)'};">${n.status}</span>
                            </div>
                        `).join('')}
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Recent Logs</h3>
                    ${logsHtml}

                    <button class="fab" onclick="openFoodLogModal()">
                        <i class="fas fa-plus"></i>
                    </button>
                </section>
            `;
        }

        function openFoodLogModal() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">Log Leftover Food</h3>
                    
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <button class="btn btn-primary" style="flex:1;" onclick="setFoodType('Cooked')">Cooked</button>
                        <button class="btn" style="flex:1; border:1px solid var(--border-color);" onclick="setFoodType('Raw')">Raw</button>
                    </div>

                    <label style="font-size:0.8rem; font-weight:600; color:var(--text-muted);">Quantity (kg/servings)</label>
                    <input type="text" id="food-qty" class="search-input" placeholder="e.g. 2kg Rice" style="width:100%; margin-bottom:15px; background:var(--bg-body);">

                    <div id="donation-option" style="display:none; margin-bottom:15px;">
                         <div style="padding:10px; background:rgba(34, 197, 94, 0.1); border-radius:8px; border:1px solid var(--success);">
                            <div style="font-weight:600; color:var(--success); font-size:0.9rem;">Start Donation?</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">FeedIndia is 2km away and accepting.</div>
                         </div>
                    </div>

                    <button class="btn btn-primary" onclick="submitFoodLog()">Log & Save</button>
                </div>
            `);
            
            // Simple listener simulation
            setTimeout(() => {
                document.getElementById('food-qty').addEventListener('input', (e) => {
                    const val = e.target.value;
                    if (val.includes('kg') || val.length > 1) {
                        document.getElementById('donation-option').style.display = 'block';
                    }
                });
            }, 100);
        }

        function setFoodType(type) {
            showToast(`Selected: ${type}`);
        }

        function submitFoodLog() {
            const qty = document.getElementById('food-qty').value;
            if (!qty) {
                showToast('Enter quantity');
                return;
            }

            data.foodWaste.logs.unshift({
                id: Date.now(),
                date: 'Just Now',
                meal: 'Custom Log',
                quantity: qty,
                status: 'Donated',
                ngo: 'FeedIndia'
            });

            closeModal();
            showToast('Food Logged & Donation Alert Sent!');
            renderFoodWaste();
        }

        function renderFreelance() {
            const main = document.getElementById('main-content');
            
            const tasksHtml = data.freelance.tasks.map(t => `
                <div class="card slide-up" style="margin-bottom:15px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <div style="font-weight:600; font-size:1rem;">${t.title}</div>
                        <div style="font-weight:700; color:var(--success);">${formatINR(t.price)}</div>
                    </div>
                    <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:10px;">
                        <i class="far fa-clock"></i> ${t.deadline} â€¢ <i class="fas fa-tools"></i> ${t.skills.join(', ')}
                    </div>
                    <button class="btn btn-primary" style="width:100%;" onclick="showToast('Applying for ${t.title}...')">Apply Now</button>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Skill & Freelance Hub</h2>
                        </div>
                        <i class="fas fa-briefcase" style="color:var(--text-muted);"></i>
                    </div>

                    <div class="card" style="background:linear-gradient(135deg, var(--primary), #4f46e5); color:white; border:none; margin-bottom:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-size:1.5rem; font-weight:800;">${formatINR(data.freelance.profile.earnings)}</div>
                                <div style="font-size:0.8rem; opacity:0.8;">Total Earnings</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-size:1.2rem; font-weight:700;">${data.freelance.profile.rating} <i class="fas fa-star" style="font-size:0.9rem; color:#facc15;"></i></div>
                                <div style="font-size:0.8rem; opacity:0.8;">${data.freelance.profile.skills.length} Skills Listed</div>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="font-size:1rem; margin:0;">Available Micro-Tasks</h3>
                        <div style="font-size:0.8rem; color:var(--primary);">Filter <i class="fas fa-filter"></i></div>
                    </div>
                    ${tasksHtml}

                    <div class="card" style="margin-top:20px; border:1px dashed var(--border-color); text-align:center; padding:20px;" onclick="openSkillModal()">
                        <i class="fas fa-plus-circle" style="font-size:1.5rem; color:var(--primary); margin-bottom:10px;"></i>
                        <div style="font-weight:600;">Add New Skill</div>
                        <div style="font-size:0.75rem; color:var(--text-muted);">Boost your profile visibility</div>
                    </div>
                </section>
            `;
        }

        function openSkillModal() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">Add Skill</h3>
                    <input type="text" id="new-skill" class="search-input" placeholder="e.g. Graphic Design" style="width:100%; margin-bottom:15px; background:var(--bg-body);">
                    <button class="btn btn-primary" onclick="addSkill()">Add to Portfolio</button>
                </div>
            `);
        }

        function addSkill() {
            const skill = document.getElementById('new-skill').value;
            if(skill) {
                data.freelance.profile.skills.push(skill);
                closeModal();
                showToast('Skill Added: ' + skill);
                renderFreelance();
            }
        }

        function renderComplaints() {
            const main = document.getElementById('main-content');
            
            const activeHtml = data.complaints.active.map(c => `
                <div class="card slide-up" style="margin-bottom:15px; border-left:4px solid ${c.status === 'Resolved' ? 'var(--accent)' : (c.status === 'In Progress' ? 'var(--warning)' : 'var(--danger)')};">
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <div>
                            <div style="font-weight:600; font-size:0.95rem;">${c.title}</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:2px;">${c.category} â€¢ ${c.date}</div>
                        </div>
                        <span class="badge" style="background:${c.status === 'Resolved' ? 'rgba(16, 185, 129, 0.1)' : (c.status === 'In Progress' ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)')}; color:${c.status === 'Resolved' ? 'var(--accent)' : (c.status === 'In Progress' ? '#f59e0b' : 'var(--danger)')}; font-size:0.7rem;">${c.status}</span>
                    </div>
                    ${c.img ? `<div style="margin-top:10px; height:100px; background:#333; border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--text-muted); font-size:0.8rem;"><i class="fas fa-image" style="margin-right:5px;"></i> Photo Attached</div>` : ''}
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Maintenance & Complaints</h2>
                        </div>
                        <i class="fas fa-history" style="color:var(--text-muted);"></i>
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <div class="card" style="flex:1; text-align:center; padding:15px; background:rgba(16, 185, 129, 0.1); border:1px solid var(--accent);">
                            <div style="font-size:1.5rem; font-weight:700; color:var(--accent);">12</div>
                            <div style="font-size:0.7rem; color:var(--text-muted);">Resolved</div>
                        </div>
                        <div class="card" style="flex:1; text-align:center; padding:15px; background:rgba(245, 158, 11, 0.1); border:1px solid #f59e0b;">
                            <div style="font-size:1.5rem; font-weight:700; color:#f59e0b;">2</div>
                            <div style="font-size:0.7rem; color:var(--text-muted);">Pending</div>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Active Tickets</h3>
                    ${activeHtml.length ? activeHtml : '<div style="text-align:center; color:var(--text-muted); padding:20px;">No active complaints</div>'}

                    <button class="fab" onclick="openComplaintModal()">
                        <i class="fas fa-plus"></i>
                    </button>
                </section>
            `;
        }

        function openComplaintModal() {
            openModal(`
                <div>
                    <h3 style="margin:0 0 15px;">New Complaint</h3>
                    
                    <label style="font-size:0.8rem; font-weight:600; color:var(--text-muted);">Describe Issue</label>
                    <textarea id="comp-desc" class="search-input" rows="3" placeholder="e.g. Fan not working in Room 101..." style="width:100%; margin-bottom:15px; background:var(--bg-body); resize:none;" oninput="suggestCategory(this.value)"></textarea>

                    <label style="font-size:0.8rem; font-weight:600; color:var(--text-muted);">Category</label>
                    <select id="comp-cat" class="search-input" style="width:100%; margin-bottom:15px; background:var(--bg-body);">
                        <option value="General">Select Category</option>
                        ${data.complaints.categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('')}
                    </select>

                    <label style="font-size:0.8rem; font-weight:600; color:var(--text-muted);">Evidence</label>
                    <div style="border:1px dashed var(--border-color); padding:20px; text-align:center; border-radius:12px; margin-bottom:20px; cursor:pointer;" onclick="showToast('Photo Upload Simulated')">
                        <i class="fas fa-camera" style="font-size:1.5rem; color:var(--text-muted); margin-bottom:5px;"></i>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Tap to Upload Photo/Video</div>
                    </div>

                    <button class="btn btn-primary" onclick="submitComplaint()">Submit Ticket</button>
                </div>
            `);
        }

        function suggestCategory(text) {
            const lowerText = text.toLowerCase();
            let match = 'General';
            for (let c of data.complaints.categories) {
                if (c.keywords.some(k => lowerText.includes(k))) {
                    match = c.name;
                    break;
                }
            }
            if (match !== 'General') {
                document.getElementById('comp-cat').value = match;
            }
        }

        function submitComplaint() {
            const desc = document.getElementById('comp-desc').value;
            const cat = document.getElementById('comp-cat').value;
            
            if (!desc) {
                showToast('Please describe the issue');
                return;
            }

            const newComplaint = {
                id: Date.now(),
                type: 'Maintenance',
                category: cat,
                title: desc,
                status: 'Submitted',
                date: 'Just Now',
                img: null
            };

            data.complaints.active.unshift(newComplaint);
            closeModal();
            showToast('Complaint Submitted Successfully');
            renderComplaints();
        }

        function renderSafety() {
            const main = document.getElementById('main-content');
            const contactsHtml = data.safety.contacts.map(c => `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;" onclick="window.location.href='tel:${c.phone}'">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div style="width:40px; height:40px; border-radius:50%; background:${c.type === 'Emergency' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)'}; display:flex; align-items:center; justify-content:center;">
                            <i class="fas ${c.type === 'Emergency' ? 'fa-exclamation-triangle' : 'fa-user-shield'}" style="color:${c.type === 'Emergency' ? 'var(--danger)' : 'var(--accent)'};"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;">${c.name}</div>
                            <div style="font-size:0.8rem; color:var(--text-muted);">${c.type}</div>
                        </div>
                    </div>
                    <i class="fas fa-phone-alt" style="color:var(--primary); font-size:1.2rem;"></i>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Safety Center</h2>
                        </div>
                    </div>

                    <button class="sos-btn" onclick="showToast('SOS Alert Sent to Security!'); navigator.vibrate([500, 200, 500]);">
                        SOS
                        <div style="font-size:0.8rem; font-weight:400; margin-top:5px;">Press & Hold</div>
                    </button>

                    <div class="card slide-up" style="margin-bottom:20px; border-left:4px solid var(--accent);">
                        <h3 style="font-size:1rem; margin:0 0 10px;">Safe Walk</h3>
                        <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:15px;">Request a companion or security escort for safe travel within campus.</p>
                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-primary" onclick="openSafeWalk()">Find Companion</button>
                            <button class="btn" style="border:1px solid var(--border-color);" onclick="openSafeWalk()">Request Escort</button>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Emergency Contacts</h3>
                    <div class="slide-up">
                        ${contactsHtml}
                    </div>

                    <div class="card" style="margin-top:20px;" onclick="openAnonymousReport()">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <i class="fas fa-user-secret" style="font-size:1.5rem; color:var(--text-light);"></i>
                            <div>
                                <div style="font-weight:600;">Anonymous Reporting</div>
                                <div style="font-size:0.8rem; color:var(--text-muted);">Report harassment or incidents safely.</div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAnalytics() {
            const main = document.getElementById('main-content');
            
            const appsHtml = data.analytics.appUsage.map(app => `
                <div style="margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:5px;">
                        <span>${app.app}</span>
                        <span>${app.pct}%</span>
                    </div>
                    <div style="height:8px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                        <div style="height:100%; width:${app.pct}%; background:var(--info);"></div>
                    </div>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">My Analytics</h2>
                        </div>
                        <i class="fas fa-download" style="color:var(--text-muted); cursor:pointer;" onclick="showToast('Downloading Report...')"></i>
                    </div>

                    <div class="card slide-up" style="text-align:center; padding:20px; margin-bottom:20px;">
                        <div style="font-size:0.9rem; color:var(--text-muted);">Daily Screen Time</div>
                        <div style="font-size:2.5rem; font-weight:800; color:var(--primary); margin:10px 0;">${data.analytics.screenTime.daily}</div>
                        <div style="font-size:0.8rem; color:var(--accent);">
                            <i class="fas fa-arrow-down"></i> 12% vs last week
                        </div>
                    </div>

                    <div class="card slide-up" style="margin-bottom:20px;">
                        <h3 style="font-size:1rem; margin:0 0 15px;">App Usage</h3>
                        ${appsHtml}
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Privacy Control</h3>
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
                            <div>
                                <div style="font-weight:600;">Location Services</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Allow apps to access location</div>
                            </div>
                            <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                                <input type="checkbox" ${data.analytics.privacy.location ? 'checked' : ''} onchange="showToast('Privacy Settings Updated')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:600;">Data Sharing</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Share anonymized usage stats</div>
                            </div>
                            <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                                <input type="checkbox" ${data.analytics.privacy.dataSharing ? 'checked' : ''} onchange="showToast('Privacy Settings Updated')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderProfile() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('dashboard')"></i>
                            <h2 class="section-title">My Profile</h2>
                        </div>
                        <i class="fas fa-pen" style="color:var(--primary); font-size:1.2rem;" onclick="showToast('Edit Profile')"></i>
                    </div>

                    <div class="card slide-up" style="text-align:center; padding:30px; margin-bottom:20px;">
                        <div style="position:relative; display:inline-block; margin-bottom:15px;">
                            <img src="https://picsum.photos/seed/user/150/150" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid var(--primary);">
                            <div style="position:absolute; bottom:0; right:0; background:var(--bg-surface); border-radius:50%; padding:5px; border:1px solid var(--border-color);">
                                <i class="fas fa-camera" style="font-size:0.8rem; color:var(--text-muted);"></i>
                            </div>
                        </div>
                        <h2 style="margin:0; font-size:1.5rem;">${state.user.name}</h2>
                        <div style="color:var(--text-muted); font-size:0.9rem; margin-top:5px;">ID: 2023CS101 â€¢ Computer Science</div>
                        
                        <div style="display:flex; justify-content:center; gap:10px; margin-top:15px;">
                             <span style="background:rgba(99, 102, 241, 0.1); color:var(--primary); padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:600;">Student</span>
                             <span style="background:rgba(16, 185, 129, 0.1); color:var(--accent); padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:600;">Dean's List</span>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                        <div class="card slide-up" style="text-align:center; padding:15px; margin:0;">
                            <div style="font-size:1.5rem; font-weight:800; color:var(--primary);">${formatINR(state.user.balance)}</div>
                            <div style="font-size:0.8rem; color:var(--text-muted);">Wallet Balance</div>
                        </div>
                        <div class="card slide-up" style="text-align:center; padding:15px; margin:0;">
                            <div style="font-size:1.5rem; font-weight:800; color:var(--secondary);">${state.user.points}</div>
                            <div style="font-size:0.8rem; color:var(--text-muted);">Campus Points</div>
                        </div>
                    </div>

                    <div class="card slide-up">
                        <div class="setting-item" onclick="showToast('Viewing Academic Records')">
                            <div style="display:flex; gap:15px; align-items:center;">
                                <i class="fas fa-graduation-cap" style="color:var(--primary); width:20px;"></i>
                                <div>
                                    <div style="font-weight:600;">Academic Records</div>
                                    <div style="font-size:0.75rem; color:var(--text-muted);">Grades & Transcripts</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:var(--text-muted); font-size:0.8rem;"></i>
                        </div>
                        <div class="setting-item" onclick="showToast('Viewing Attendance')">
                            <div style="display:flex; gap:15px; align-items:center;">
                                <i class="fas fa-calendar-check" style="color:var(--accent); width:20px;"></i>
                                <div>
                                    <div style="font-weight:600;">Attendance History</div>
                                    <div style="font-size:0.75rem; color:var(--text-muted);">View detailed logs</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:var(--text-muted); font-size:0.8rem;"></i>
                        </div>
                        <div class="setting-item" onclick="showToast('Manage Cards')">
                            <div style="display:flex; gap:15px; align-items:center;">
                                <i class="fas fa-credit-card" style="color:var(--secondary); width:20px;"></i>
                                <div>
                                    <div style="font-weight:600;">Payment Methods</div>
                                    <div style="font-size:0.75rem; color:var(--text-muted);">Manage cards & UPI</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:var(--text-muted); font-size:0.8rem;"></i>
                        </div>
                    </div>

                    <button class="btn" style="margin-top:20px; border-color:var(--danger); color:var(--danger);" onclick="router('login'); showToast('Logged Out');">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </section>
            `;
        }

        function renderSettings() {
            const main = document.getElementById('main-content');
            
            const iotHtml = data.iot.map((d, i) => `
                <div class="iot-card" onclick="toggleIoT(${i})" style="background:${d.status ? 'rgba(99, 102, 241, 0.1)' : 'var(--bg-surface)'}; border:1px solid ${d.status ? 'var(--primary)' : 'var(--border-color)'}; padding:15px; border-radius:12px; display:flex; flex-direction:column; gap:10px; cursor:pointer; transition:all 0.2s;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <i class="fas ${d.type === 'light' ? 'fa-lightbulb' : d.type === 'ac' ? 'fa-wind' : 'fa-lock'}" style="font-size:1.2rem; color:${d.status ? 'var(--primary)' : 'var(--text-muted)'};"></i>
                        <div style="width:8px; height:8px; border-radius:50%; background:${d.status ? 'var(--accent)' : 'var(--text-muted)'};"></div>
                    </div>
                    <div style="font-weight:600; font-size:0.9rem;">${d.name}</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">${d.status ? 'On' : 'Off'} ${d.temp ? 'â€¢ ' + d.temp + 'Â°C' : ''}</div>
                </div>
            `).join('');

            main.innerHTML = `
                <section class="fade-in">
                    <div class="section-header">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-arrow-left" onclick="router('explore')"></i>
                            <h2 class="section-title">Settings & IoT</h2>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Accessibility</h3>
                    <div class="card slide-up" style="margin-bottom:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <div>
                                <div style="font-weight:600;">Dyslexia Friendly</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Use OpenDyslexic font</div>
                            </div>
                            <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                                <input type="checkbox" onchange="document.body.classList.toggle('dyslexic-font'); showToast('Font Updated')">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <div>
                                <div style="font-weight:600;">High Contrast</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Increase UI contrast</div>
                            </div>
                            <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                                <input type="checkbox" onchange="document.body.classList.toggle('high-contrast'); showToast('Theme Updated')">
                                <span class="slider"></span>
                            </label>
                        </div>
                         <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:600;">Text to Speech</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">Read content aloud</div>
                            </div>
                            <label class="switch" style="position:relative; display:inline-block; width:40px; height:24px;">
                                <input type="checkbox" onchange="showToast('TTS Enabled')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Smart Room Control</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                        ${iotHtml}
                    </div>

                    <h3 style="font-size:1rem; margin-bottom:15px;">Integrations</h3>
                    <div class="card slide-up">
                         <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px; cursor:pointer;" onclick="toggleCalendarSync('google')">
                            <i class="fab fa-google" style="font-size:1.2rem; color:white;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:600;">Google Calendar</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">${data.integrations.google.connected ? 'Connected as ' + data.integrations.google.email : 'Tap to connect'}</div>
                            </div>
                             <span style="font-size:0.8rem; color:${data.integrations.google.connected ? 'var(--accent)' : 'var(--text-muted)'};">${data.integrations.google.connected ? 'Active' : 'Link'}</span>
                        </div>
                        <div style="display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="toggleCalendarSync('outlook')">
                            <i class="fab fa-microsoft" style="font-size:1.2rem; color:#00a4ef;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:600;">Outlook</div>
                                <div style="font-size:0.75rem; color:var(--text-muted);">${data.integrations.outlook.connected ? 'Connected' : 'Sync university mail'}</div>
                            </div>
                             <span style="font-size:0.8rem; color:${data.integrations.outlook.connected ? 'var(--accent)' : 'var(--text-muted)'};">${data.integrations.outlook.connected ? 'Active' : 'Link'}</span>
                        </div>
                    </div>
                </section>
            `;
        }

        window.addEventListener('DOMContentLoaded', init);
        document.getElementById('modal-overlay').addEventListener('click', (e) => { if (e.target.id === 'modal-overlay') closeModal(); });
    </script>
</body>
</html>